<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading Test - Offline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ielts-red': '#DC2626',
                        'ielts-gray': '#F3F4F6',
                        'ielts-border': '#E5E7EB'
                    }
                }
            }
        }
    </script>
    <style>
        .highlight {
            background-color: rgb(254 240 138);__
        }
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Enhanced bullet points for flow chart */
        .flow-chart-list {
            list-style: none;
            padding-left: 0;
        }
        .flow-chart-list li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        .flow-chart-list li:before {
            content: '‚óè';
            color: #DC2626;
            font-size: 16px;
            position: absolute;
            left: 0;
            top: 0;
            line-height: 1.5;
        }

        /* Welcome Modal FX (copied from Listening Mock 1) */
        @keyframes glitchFadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
                filter: none;
            }
            10% {
                opacity: 0.9;
                transform: scale(1) translateX(-5px) skewX(-2deg);
                filter: hue-rotate(90deg);
            }
            20% {
                opacity: 0.85;
                transform: scale(1.02) translateX(5px) skewX(2deg);
                filter: hue-rotate(-90deg) saturate(2);
            }
            30% {
                opacity: 0.7;
                transform: scale(0.98) translateX(-3px);
                filter: blur(1px) hue-rotate(180deg);
            }
            40% {
                opacity: 0.6;
                transform: scale(1.01) translateX(4px) skewY(-1deg);
                filter: invert(0.1) hue-rotate(45deg);
            }
            50% {
                opacity: 0.5;
                transform: scale(0.97) translateX(-6px) skewX(-3deg);
                filter: blur(2px) brightness(1.5);
            }
            60% {
                opacity: 0.4;
                transform: scale(1.03) translateX(3px);
                filter: hue-rotate(-45deg) contrast(1.5);
            }
            70% {
                opacity: 0.3;
                transform: scale(0.95) translateY(-3px) skewX(4deg);
                filter: blur(3px) saturate(0.5);
            }
            80% {
                opacity: 0.2;
                transform: scale(1.05) translateX(-4px) translateY(2px);
                filter: blur(4px) brightness(2);
            }
            90% {
                opacity: 0.1;
                transform: scale(0.9) skewY(2deg);
                filter: blur(6px) hue-rotate(270deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.8) translateY(-10px);
                filter: blur(10px);
            }
        }

        .glitch-fade-out {
            animation: glitchFadeOut 0.8s ease-out forwards;
        }

        @keyframes pulseGlow {
            0%, 100% {
                opacity: 0.4;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 0.7;
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        @keyframes lightningArc1 {
            0%, 100% { opacity: 0; }
            20% { opacity: 0; }
            21% { opacity: 0.8; }
            22% { opacity: 0.2; }
            23% { opacity: 0.9; }
            24% { opacity: 0; }
            60% { opacity: 0; }
            61% { opacity: 0.7; }
            62% { opacity: 0.1; }
            63% { opacity: 0.6; }
            64% { opacity: 0; }
        }

        @keyframes lightningArc2 {
            0%, 100% { opacity: 0; }
            40% { opacity: 0; }
            41% { opacity: 0.9; }
            42% { opacity: 0.15; }
            43% { opacity: 0.7; }
            44% { opacity: 0; }
            85% { opacity: 0; }
            86% { opacity: 0.6; }
            87% { opacity: 0.1; }
            88% { opacity: 0.8; }
            89% { opacity: 0; }
        }

        @keyframes lightningArc3 {
            0%, 100% { opacity: 0; }
            10% { opacity: 0; }
            11% { opacity: 0.7; }
            12% { opacity: 0.1; }
            13% { opacity: 0.8; }
            14% { opacity: 0; }
            50% { opacity: 0; }
            51% { opacity: 0.6; }
            52% { opacity: 0.2; }
            53% { opacity: 0.9; }
            54% { opacity: 0; }
        }

        @keyframes lightningArc4 {
            0%, 100% { opacity: 0; }
            30% { opacity: 0; }
            31% { opacity: 0.8; }
            32% { opacity: 0.1; }
            33% { opacity: 0.7; }
            34% { opacity: 0; }
            70% { opacity: 0; }
            71% { opacity: 0.9; }
            72% { opacity: 0.15; }
            73% { opacity: 0.6; }
            74% { opacity: 0; }
        }

        @keyframes logoElectrocute {
            0%, 100% {
                filter: drop-shadow(0 0 8px rgba(30,144,255,0.3)) drop-shadow(0 0 15px rgba(0,71,171,0.2));
            }
            21%, 23%, 41%, 43%, 51%, 53%, 61%, 63%, 71%, 73%, 86%, 88% {
                filter: drop-shadow(0 0 12px rgba(80,160,255,0.5)) drop-shadow(0 0 25px rgba(30,144,255,0.4)) brightness(1.15);
            }
            22%, 42%, 52%, 62%, 72%, 87% {
                filter: drop-shadow(0 0 18px rgba(120,180,255,0.6)) drop-shadow(0 0 35px rgba(30,144,255,0.5)) brightness(1.25);
            }
        }

        @keyframes plasmaRing {
            0%, 100% {
                box-shadow: inset 0 0 10px rgba(30,144,255,0.15), 0 0 8px rgba(30,144,255,0.1);
            }
            21%, 23%, 51%, 53%, 86%, 88% {
                box-shadow: inset 0 0 15px rgba(80,160,255,0.3), 0 0 15px rgba(30,144,255,0.25);
            }
            22%, 52%, 87% {
                box-shadow: inset 0 0 20px rgba(100,170,255,0.4), 0 0 25px rgba(60,140,255,0.35);
            }
        }

        .plasma-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 115px;
            height: 115px;
            border-radius: 50%;
            border: 1px solid transparent;
            animation: plasmaRing 3s ease-in-out infinite;
            z-index: 0;
        }

        .lightning-arc {
            position: absolute;
            z-index: 2;
        }

        .electric-logo {
            animation: logoElectrocute 3s ease-in-out infinite;
        }

        .logo-link {
            display: block;
            position: relative;
            z-index: 1;
        }

        .logo-link .electric-logo {
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        #cursor-lightning-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3500;
        }

        .electric-logo.zapping {
            filter: drop-shadow(0 0 20px rgba(100,200,255,1)) drop-shadow(0 0 35px rgba(60,160,255,0.8)) brightness(1.3) !important;
        }

        .plasma-ring.zapping {
            animation: plasmaRingZap 0.15s ease-in-out infinite !important;
            box-shadow: inset 0 0 35px rgba(100,200,255,0.9), 0 0 45px rgba(30,144,255,0.8) !important;
        }

        @keyframes plasmaRingZap {
            0%, 100% {
                box-shadow: inset 0 0 30px rgba(100,200,255,0.9), 0 0 40px rgba(30,144,255,0.8);
            }
            50% {
                box-shadow: inset 0 0 45px rgba(150,220,255,1), 0 0 60px rgba(60,160,255,1);
            }
        }

        @keyframes curveStrike1 {
            0%, 100% { opacity: 0; }
            18% { opacity: 0; }
            19% { opacity: 1; }
            20% { opacity: 0.2; }
            21% { opacity: 0.9; }
            22% { opacity: 0.1; }
            23% { opacity: 0.7; }
            24% { opacity: 0; }
        }

        @keyframes curveStrike2 {
            0%, 100% { opacity: 0; }
            48% { opacity: 0; }
            49% { opacity: 1; }
            50% { opacity: 0.15; }
            51% { opacity: 0.85; }
            52% { opacity: 0.1; }
            53% { opacity: 0.6; }
            54% { opacity: 0; }
        }

        @keyframes curveStrike3 {
            0%, 100% { opacity: 0; }
            78% { opacity: 0; }
            79% { opacity: 1; }
            80% { opacity: 0.2; }
            81% { opacity: 0.9; }
            82% { opacity: 0.15; }
            83% { opacity: 0.7; }
            84% { opacity: 0; }
        }

        @keyframes impactFlash1 {
            0%, 100% { opacity: 0; transform: scale(0); }
            19%, 23% { opacity: 1; transform: scale(1); }
            20%, 22% { opacity: 0.3; transform: scale(1.2); }
            21% { opacity: 0.9; transform: scale(0.8); }
            24% { opacity: 0; transform: scale(0); }
        }

        @keyframes impactFlash2 {
            0%, 100% { opacity: 0; transform: scale(0); }
            49%, 53% { opacity: 1; transform: scale(1); }
            50%, 52% { opacity: 0.3; transform: scale(1.2); }
            51% { opacity: 0.9; transform: scale(0.8); }
            54% { opacity: 0; transform: scale(0); }
        }

        @keyframes impactFlash3 {
            0%, 100% { opacity: 0; transform: scale(0); }
            79%, 83% { opacity: 1; transform: scale(1); }
            80%, 82% { opacity: 0.3; transform: scale(1.2); }
            81% { opacity: 0.9; transform: scale(0.8); }
            84% { opacity: 0; transform: scale(0); }
        }

        .curve-strike {
            position: absolute;
            z-index: 3;
            pointer-events: none;
        }

        .impact-flash {
            position: absolute;
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, rgba(200,230,255,1) 0%, rgba(100,180,255,0.7) 30%, rgba(60,140,255,0.3) 60%, transparent 80%);
            border-radius: 50%;
            z-index: 4;
        }

        @keyframes welcomeFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        #premium-info-content::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-white font-sans">
    <!-- Cursor Lightning Container -->
    <div id="cursor-lightning-container"></div>

    <!-- Welcome Modal (from Listening Mock 1) -->
    <div id="welcome-modal-bg" style="position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(0,0,0,0.85) 0%, rgba(20,20,40,0.95) 100%); z-index: 3000; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);">
        <div id="welcome-modal" style="background: linear-gradient(145deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%); border-radius: 18px; box-shadow: 0 25px 50px rgba(0,0,0,0.5), 0 0 35px rgba(212,175,55,0.15), inset 0 1px 0 rgba(255,255,255,0.1); padding: 32px 32px; max-width: 460px; max-height: 92vh; margin: 15px; text-align: center; position: relative; animation: welcomeFadeIn 0.6s ease-out; border: 1px solid rgba(212,175,55,0.3); overflow-y: auto;">
            <div style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 60%; height: 2px; background: linear-gradient(90deg, transparent, #d4af37, #f4d03f, #d4af37, transparent); border-radius: 0 0 3px 3px;"></div>
            <div class="logo-container" style="margin-bottom: 20px; position: relative; display: inline-block;">
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 135px; height: 135px; background: radial-gradient(circle, rgba(30,144,255,0.15) 0%, rgba(0,71,171,0.1) 40%, transparent 70%); border-radius: 50%; animation: pulseGlow 3s ease-in-out infinite;"></div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 112px; height: 112px; background: radial-gradient(circle, rgba(0,51,102,0.2) 0%, rgba(25,25,112,0.15) 50%, transparent 70%); border-radius: 50%; animation: pulseGlow 3s ease-in-out infinite 0.5s;"></div>
                <div class="plasma-ring" style="width: 100px; height: 100px;"></div>

                <svg class="lightning-arc" style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 36px; height: 20px; animation: lightningArc1 3s linear infinite;" viewBox="0 0 40 22">
                    <path d="M2,20 L8,12 L6,12 L14,6 L11,6 L20,2 L29,6 L26,6 L34,12 L32,12 L38,20" stroke="#4aa8ff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 3px rgba(74,168,255,0.6));"/>
                </svg>
                <svg class="lightning-arc" style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 40px; height: 18px; animation: lightningArc2 3s linear infinite;" viewBox="0 0 45 20">
                    <path d="M3,2 L10,8 L7,8 L18,14 L14,14 L23,18 L32,14 L28,14 L38,8 L35,8 L42,2" stroke="#5cb4ff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 3px rgba(92,180,255,0.6));"/>
                </svg>
                <svg class="lightning-arc" style="position: absolute; left: -8px; top: 50%; transform: translateY(-50%); width: 18px; height: 36px; animation: lightningArc3 3s linear infinite;" viewBox="0 0 20 40">
                    <path d="M18,3 L12,10 L12,7 L6,18 L6,14 L2,20 L6,26 L6,22 L12,33 L12,30 L18,37" stroke="#4aa8ff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 3px rgba(74,168,255,0.6));"/>
                </svg>
                <svg class="lightning-arc" style="position: absolute; right: -8px; top: 50%; transform: translateY(-50%); width: 18px; height: 36px; animation: lightningArc4 3s linear infinite;" viewBox="0 0 20 40">
                    <path d="M2,3 L8,10 L8,7 L14,18 L14,14 L18,20 L14,26 L14,22 L8,33 L8,30 L2,37" stroke="#5cb4ff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 3px rgba(92,180,255,0.6));"/>
                </svg>
                <svg class="lightning-arc" style="position: absolute; top: 2px; left: 2px; width: 22px; height: 22px; animation: lightningArc1 3s linear infinite 0.3s;" viewBox="0 0 25 25">
                    <path d="M22,22 L16,17 L18,16 L12,12 L14,11 L5,5" stroke="#3d9eff" stroke-width="1" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 2px rgba(61,158,255,0.5));"/>
                </svg>
                <svg class="lightning-arc" style="position: absolute; top: 2px; right: 2px; width: 22px; height: 22px; animation: lightningArc3 3s linear infinite 0.2s;" viewBox="0 0 25 25">
                    <path d="M3,22 L9,17 L7,16 L13,12 L11,11 L20,5" stroke="#3d9eff" stroke-width="1" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 2px rgba(61,158,255,0.5));"/>
                </svg>
                <svg class="lightning-arc" style="position: absolute; bottom: 2px; left: 2px; width: 22px; height: 22px; animation: lightningArc4 3s linear infinite 0.4s;" viewBox="0 0 25 25">
                    <path d="M22,3 L16,8 L18,9 L12,13 L14,14 L5,20" stroke="#3d9eff" stroke-width="1" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 2px rgba(61,158,255,0.5));"/>
                </svg>
                <svg class="lightning-arc" style="position: absolute; bottom: 2px; right: 2px; width: 22px; height: 22px; animation: lightningArc2 3s linear infinite 0.5s;" viewBox="0 0 25 25">
                    <path d="M3,3 L9,8 L7,9 L13,13 L11,14 L20,20" stroke="#3d9eff" stroke-width="1" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 2px rgba(61,158,255,0.5));"/>
                </svg>

                <a href="https://t.me/shohrukhposts" target="_blank" rel="noopener noreferrer" class="logo-link">
                    <img src="https://pub-a3ed3eec4ae344b4917067de0a9376f1.r2.dev/20231027_164620_0000-photoaidcom-cropped.png" alt="CDI Logo" class="electric-logo" style="width: 85px; height: 85px; object-fit: contain; border-radius: 10px;">
                </a>

                <svg class="curve-strike" style="top: -25px; left: -35px; width: 85px; height: 70px; animation: curveStrike1 6s linear infinite;" viewBox="0 0 100 80">
                    <path d="M5,5 L15,12 L12,14 L28,22 L24,25 L42,35 L38,38 L58,48 L54,50 L75,60 L70,62 L95,75" stroke="#4aa8ff" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 4px rgba(74,168,255,0.8));"/>
                    <path d="M6,6 L16,13 L13,15 L29,23 L25,26 L43,36 L39,39 L59,49 L55,51 L76,61 L71,63 L96,76" stroke="rgba(180,230,255,0.5)" stroke-width="1" fill="none"/>
                </svg>
                <div class="impact-flash" style="top: 26px; right: 5px; animation: impactFlash1 6s linear infinite;"></div>

                <svg class="curve-strike" style="bottom: -20px; right: -30px; width: 78px; height: 75px; animation: curveStrike2 6s linear infinite;" viewBox="0 0 90 85">
                    <path d="M85,80 L78,68 L82,66 L68,52 L72,50 L55,38 L60,35 L42,25 L48,22 L28,12 L34,10 L10,2" stroke="#5cb4ff" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 4px rgba(92,180,255,0.8));"/>
                    <path d="M84,79 L77,67 L81,65 L67,51 L71,49 L54,37 L59,34 L41,24 L47,21 L27,11 L33,9 L9,1" stroke="rgba(180,230,255,0.5)" stroke-width="1" fill="none"/>
                </svg>
                <div class="impact-flash" style="top: -2px; left: 30px; animation: impactFlash2 6s linear infinite;"></div>

                <svg class="curve-strike" style="top: 18px; left: -38px; width: 82px; height: 78px; animation: curveStrike3 6s linear infinite;" viewBox="0 0 95 90">
                    <path d="M2,15 L18,20 L15,24 L35,32 L30,36 L52,45 L48,50 L68,60 L62,65 L80,78 L75,82 L92,88" stroke="#4aa8ff" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="bevel" style="filter: drop-shadow(0 0 4px rgba(74,168,255,0.8));"/>
                    <path d="M3,16 L19,21 L16,25 L36,33 L31,37 L53,46 L49,51 L69,61 L63,66 L81,79 L76,83 L93,89" stroke="rgba(180,230,255,0.5)" stroke-width="1" fill="none"/>
                </svg>
                <div class="impact-flash" style="bottom: 6px; right: 12px; animation: impactFlash3 6s linear infinite;"></div>
            </div>

            <h1 style="font-size: 20px; font-weight: 700; color: #ffffff; margin-bottom: 6px; letter-spacing: 0.5px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">Welcome to the CDI Listening Platform</h1>
            <p style="font-size: 13px; color: #d4af37; font-weight: 500; margin-bottom: 20px; font-style: italic;">You're not here by accident.</p>

            <div style="text-align: left; color: #e0e0e0; font-size: 12px; line-height: 1.65; margin-bottom: 20px;">
                <p style="margin-bottom: 12px;">This platform is designed for <strong style="color: #f4d03f;">serious IELTS candidates</strong> who want to practise with authentic, exam-level materials in a controlled, exam-like environment.</p>
                <p style="margin-bottom: 12px;">The CDI system, structure, and interface you're using are <strong style="color: #f4d03f;">custom-built</strong> to help you focus, track progress, and test your real listening level ‚Äî not inflated practice results.</p>
                <p style="margin-bottom: 12px;">You're paying for <strong style="color: #f4d03f;">quality, precision, and access</strong>, not shortcuts.</p>
                <p style="margin-bottom: 0;">If you're committed to real improvement, <strong style="color: #f4d03f;">you're in the right place.</strong></p>
            </div>

            <div style="display: flex; align-items: flex-start; gap: 10px; background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 8px; padding: 11px 13px; margin-bottom: 18px;">
                <span style="font-size: 16px; color: #ffc107; flex-shrink: 0;">‚ö†Ô∏è</span>
                <p style="font-size: 11px; color: #ccc; margin: 0; line-height: 1.5;">This platform is intentionally designed to work only on <strong style="color: #ffc107;">PCs and laptops</strong> for the best exam-like experience.</p>
            </div>

            <div style="width: 80%; height: 1px; background: linear-gradient(90deg, transparent, rgba(212,175,55,0.4), transparent); margin: 0 auto 18px;"></div>

            <button id="welcome-start-btn" style="background: linear-gradient(135deg, #d4af37 0%, #f4d03f 50%, #d4af37 100%); color: #1a1a2e; font-weight: 700; font-size: 13px; padding: 13px 26px; border: none; border-radius: 28px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(212,175,55,0.4), inset 0 1px 0 rgba(255,255,255,0.3); letter-spacing: 0.3px; display: inline-flex; align-items: center; gap: 7px;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(212,175,55,0.5), inset 0 1px 0 rgba(255,255,255,0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(212,175,55,0.4), inset 0 1px 0 rgba(255,255,255,0.3)';">
                <span style="font-size: 15px;">‚ñ∂</span> Start only when you're ready to take it seriously.
            </button>

            <p style="font-size: 9px; color: #666; margin-top: 15px;">¬© CDI Platform by @shohrukhposts</p>
        </div>
    </div>

    <!-- Test Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-1 sticky top-0 z-50 shadow-sm">
        <div class="w-full flex items-center justify-between">
            <!-- Left section - Logo and Test taker ID -->
            <div class="flex items-center space-x-8 flex-1 justify-start min-w-0">
                <h1 class="text-red-600 font-bold text-2xl tracking-wide whitespace-nowrap" data-testid="ielts-logo">IELTS</h1>
                <span class="text-gray-500 text-sm font-medium whitespace-nowrap" data-testid="test-taker-id">Test taker ID</span>
            </div>

            <!-- Center section - Telegram link -->
            <div class="flex-1 flex justify-center px-4">
                <a href="https://t.me/shohrukhposts" target="_blank" class="inline-flex items-center gap-2 text-sm font-semibold text-blue-700 bg-blue-50 border border-blue-200 px-3 py-1 rounded-full shadow-sm hover:bg-blue-100 hover:text-blue-900 transition-colors">
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                    </svg>
                    @shohrukhposts
                </a>
            </div>

            <!-- Right section - Timer and navigation icons -->
            <div class="flex items-center space-x-3 flex-1 justify-end min-w-0">
                <!-- Timer -->
                <div class="flex items-center space-x-2 bg-gray-50 px-3 py-1 rounded-lg whitespace-nowrap" data-testid="timer-display">
                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12,6 12,12 16,14"></polyline>
                    </svg>
                    <div id="timer-section" class="flex items-center space-x-1">
                        <button id="timer-text" class="text-sm font-mono font-semibold text-gray-700 hover:text-gray-900 cursor-pointer transition-colors duration-200" data-testid="timer-text" title="Click to edit time">
                            60:00
                        </button>
                        <button id="timer-toggle" class="p-0.5 hover:bg-gray-200 rounded transition-colors duration-200">
                            <svg id="play-icon" class="w-3 h-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <polygon points="5,3 19,12 5,21"></polygon>
                            </svg>
                            <svg id="pause-icon" class="w-3 h-3 text-gray-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <rect x="6" y="4" width="4" height="16"></rect>
                                <rect x="14" y="4" width="4" height="16"></rect>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Premium VIP Button -->
                <button id="premium-btn" class="text-xs font-semibold text-white px-3 py-1 rounded-full shadow" style="background: linear-gradient(135deg, #f59e0b, #ec4899, #ef4444); border: none; display: flex; align-items: center; gap: 6px;">
                    <svg style="width: 12px; height: 12px; fill: currentColor;" viewBox="0 0 20 20">
                        <path d="M10 2l2.39 4.84L18 7.27l-3.91 3.81L14.78 18 10 15.27 5.22 18l.69-6.92L2 7.27l5.61-.43L10 2z"/>
                    </svg>
                    VIP Pack
                </button>

                <!-- Navigation icons -->
                <div class="flex items-center space-x-1">
                    <button class="p-1.5 hover:bg-gray-100 rounded-lg transition-colors duration-200" title="Connection status">
                        <svg class="w-5 h-5 text-gray-500 hover:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                            <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                            <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                            <line x1="12" y1="20" x2="12.01" y2="20"></line>
                        </svg>
                    </button>
                    <button class="p-1.5 hover:bg-gray-100 rounded-lg transition-colors duration-200" title="Notifications">
                        <svg class="w-5 h-5 text-gray-500 hover:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                    </button>
                    <button class="p-1.5 hover:bg-gray-100 rounded-lg transition-colors duration-200" title="Menu">
                        <svg class="w-5 h-5 text-gray-500 hover:text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div id="main-container" class="flex-1 flex relative" style="height: calc(100vh - 100px);">
        <!-- Left Panel - Passage -->
        <div id="left-panel" class="overflow-auto" style="width: 50%;">
            <div class="flex-1 p-6 overflow-auto">
                <div id="part-header" class="bg-gray-100 p-4 rounded mb-6">
                    <h2 id="part-title" class="font-bold mb-2">Part 1</h2>
                    <p id="part-instructions" class="text-sm text-gray-700">You should spend about 20 minutes on Questions 1-13 which are based on Reading Passage 1.</p>
                </div>

                <div class="prose max-w-none">
                    <div class="flex items-center justify-between mb-4">
                        <h3 id="passage-title" class="text-lg font-bold">The History of the Guitar</h3>
                        <div class="flex items-center space-x-2 text-sm text-gray-600 bg-blue-50 px-3 py-1 rounded-full">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9,12l2,2 4,-4"></path>
                            </svg>
                            <span>Select text to highlight and tap on it to clear</span>
                        </div>
                    </div>
                    <div id="passage-content" class="text-justify leading-relaxed space-y-4">
                        <!-- Content will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Resize Handle -->
        <div id="resize-handle" class="w-2 bg-gray-200 hover:bg-gray-300 cursor-col-resize transition-colors flex-shrink-0">
            <div class="w-full h-full flex items-center justify-center">
                <div class="w-1 h-8 bg-gray-400 rounded-full"></div>
            </div>
        </div>

        <!-- Right Panel - Questions -->
        <div id="right-panel" class="overflow-auto flex-1" style="width: 50%;">
            <div id="questions-container" class="flex-1 p-6 bg-white overflow-auto">
                <!-- Questions will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Test Footer -->

  <footer class="bg-white border-t border-gray-200 sticky bottom-0" data-testid="test-footer">
    <div class="flex justify-between items-center px-4 py-0.5">
        <!-- Navigation arrows -->
        <div class="flex items-center space-x-4 mr-6">
            <button id="prev-part-btn" class="w-8 h-8 bg-red-600 hover:bg-red-700 rounded-full text-white disabled:opacity-50 flex items-center justify-center" disabled>
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <polyline points="15,18 9,12 15,6"></polyline>
                </svg>
            </button>
            <button id="next-part-btn" class="w-8 h-8 bg-red-600 hover:bg-red-700 rounded-full text-white flex items-center justify-center">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <polyline points="9,18 15,12 9,6"></polyline>
                </svg>
            </button>
        </div>

        <!-- Part indicators -->
        <div id="parts-container" class="flex-1 flex flex-wrap justify-between items-center gap-2 relative">
            <!-- Part indicators will be loaded dynamically -->
        </div>

        <!-- Submit button -->
        <button id="submit-test-btn" class="bg-red-600 text-white px-3 py-1 font-medium hover:bg-red-700 h-8 text-sm rounded ml-4">
            Submit Test
        </button>
    </div>

</footer>

    <!-- Highlight Buttons -->
    <div id="highlight-button" class="fixed x-50 bg-white hover:bg-gray-50 text-gray-800 border border-gray-200 px-3 py-1 rounded shadow-lg cursor-pointer text-sm font-medium transition colors hidden">
        Highlight
    </div>

    <div id="clear-highlight-button" class="fixed z-50 bg-white hover:bg-gray-50 text-gray-800 border border-gray-300 px-3 py-1 rounded shadow-lg cursor-pointer text-sm font-medium transition-colors hidden">
        Clear Highlight
    </div>

    <!-- Submit Confirmation Modal -->
    <div id="submit-confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <h2 class="text-xl font-bold mb-4 text-center">Submit Test</h2>
            <div class="mb-6">
                <p class="text-gray-700 text-center">
                    Are you sure you want to submit your test?
                </p>
                <p class="text-sm text-gray-500 text-center mt-2">
                    Once submitted, you will see the answers and cannot continue the test.
                </p>
            </div>
            <div class="flex gap-3 justify-center">
                <button id="cancel-submit" class="px-6 py-2 border border-gray-300 rounded hover:bg-gray-50 font-medium">
                    Cancel
                </button>
                <button id="confirm-submit" class="px-6 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-medium">
                    Submit Test
                </button>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div id="results-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4">Test Results</h2>
            <div class="flex-1 overflow-y-auto min-h-0">
                <div id="results-content">
                    <!-- Results will be displayed here -->
                </div>
            </div>
            <button id="close-results" class="mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 flex-shrink-0">
                Close
            </button>
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premium-modal-bg" style="position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.6); z-index: 2000;">
        <div id="premium-modal" style="background: white; border-radius: 16px; box-shadow: 0 25px 50px rgba(0,0,0,0.3); padding: 18px; max-width: 400px; max-height: 98vh; margin: 5px; text-align: left; position: relative; animation: fadeInScale 0.3s ease-out; overflow: hidden;">
            <button id="close-premium-modal" style="position: absolute; top: 4px; right: 8px; color: #9ca3af; font-size: 22px; font-weight: bold; background: none; border: none; cursor: pointer; display: none; z-index: 10;" onmouseover="this.style.color='#ef4444'" onmouseout="this.style.color='#9ca3af'">&times;</button>
            <div id="premium-video-container" style="width: 100%; display: none; flex-direction: column; align-items: center; justify-content: center;">
                <video id="premium-intro-video" style="border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 4px; width: 100%; max-width: 300px; background: black;" src="https://pub-a3ed3eec4ae344b4917067de0a9376f1.r2.dev/IELTS_Pack_Intro_Video_Generated.mp4" controls></video>
            </div>
            <div id="premium-info-content" style="font-size: 12px; color: #374151; opacity: 0; transition: opacity 0.7s; pointer-events: none; max-height: calc(98vh - 50px); overflow-y: scroll; overflow-x: hidden; scrollbar-width: none; -ms-overflow-style: none; padding-bottom: 10px;">
                <h2 style="font-size: 16px; font-weight: bold; color: #f59e0b; margin-bottom: 6px; display: flex; align-items: center;">
                    <svg style="width: 16px; height: 16px; margin-right: 4px; fill: #fbbf24;" viewBox="0 0 20 20"><path d="M10 2l2.39 4.84L18 7.27l-3.91 3.81L14.78 18 10 15.27 5.22 18l.69-6.92L2 7.27l5.61-.43L10 2z"/></svg>
                    IELTS VIP Pack
                </h2>
                <span style="font-weight: 600; font-size: 11px;">üì¶ What's included:</span>
                <ul style="list-style: disc; padding-left: 16px; margin: 2px 0 6px 0; line-height: 1.4;">
                    <li>‚úîÔ∏è CDI Reading & Listening (13-Full Mock)</li>
                    <li>‚úîÔ∏è Clear Accurate Answer Explanations</li>
                    <li>‚úîÔ∏è Exam Materials</li>
                    <li>‚úîÔ∏è Clean, distraction-free interface</li>
                    <li>‚úîÔ∏è 10 Bonus Tests (from my own exam)</li>
                    <li>‚úîÔ∏è High-quality PDF versions for printing</li>
                    <li>‚úîÔ∏è Watermark-free PDF (not even my link)</li>
                    <li>‚úîÔ∏è Life-time access</li>
                    <li>‚úîÔ∏è Early access to future Volume 9 release üòâ</li>
                    <li>‚ûï 10 More CDI Tests will be Uploaded Soon</li>
                </ul>
                <span style="font-weight: 600; font-size: 11px;">üéØ Who this is for:</span>
                <ul style="list-style: disc; padding-left: 16px; margin: 2px 0 6px 0; line-height: 1.4;">
                    <li>January-March Test Takers</li>
                    <li>Teachers: Class Materials (for their students)</li>
                    <li>Those who want real practice.</li>
                    <li>People tired of random, low-quality materials</li>
                </ul>
                <div style="margin: 4px 0;">
                    <span style="font-weight: 600; font-size: 11px;">üÜì FREE DEMO TESTS</span>
                    <a href="https://t.me/shohrukhposts/1091" target="_blank" style="display: inline-block; margin-left: 6px; padding: 4px 10px; background: #2563eb; color: white; font-weight: 600; border-radius: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-decoration: none; font-size: 10px; vertical-align: middle;" onmouseover="this.style.background='#1d4ed8'" onmouseout="this.style.background='#2563eb'">Try Demo</a>
                </div>
                <div style="margin-top: 6px;">
                    <span style="font-weight: 600; font-size: 11px;">üõ´ Price:</span><br>
                    <span style="font-size: 14px; font-weight: bold; color: #16a34a;">149,000 so'm</span><br>
                    <span style="font-size: 14px; font-weight: bold; color: #dc2626;">üí≤Only 99,000 so'm (‚Äì34%)</span><br>
                    <span style="color: #ca8a04; font-size: 11px;">Eligible for: ‚ú®-50% ‚Äî&gt; for my next CDI Pack</span>
                </div>
                <div style="margin-top: 6px;">
                    <span style="font-weight: 600; font-size: 11px;">üîê One-time access üîë</span><br>
                    <span style="color: #6b7280; font-size: 10px;">‚ÑπÔ∏è This pack will not be publicly shared or reposted.</span>
                </div>
                <a href="https://t.me/Shohrukh_05?text=Hi%2C%20I%20wanted%20to%20purchase%20access%20to%20the%20VIP%20channel" target="_blank" style="display: block; width: 90%; margin-left: auto; margin-right: auto; text-align: center; background: linear-gradient(to right, #fbbf24, #ec4899, #ef4444); color: white; font-weight: bold; padding: 10px 16px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); margin-top: 12px; margin-bottom: 8px; font-size: 14px; text-decoration: none; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">üì© Tap VIP ACCESS</a>
            </div>
        </div>
    </div>

    <script>
        // Test Data
        const testData = {
            "id": "ielts-reading-test-1",
            "title": "IELTS Reading Test",
            "duration": 60,
            "parts": [
                {
                    "id": 1,
                    "title": "Part 1",
                    "instructions": "You should spend about 20 minutes on Questions 1-13 which are based on Reading Passage 1.",
                    "questionRange": "1‚Äì13",
                    "passage": {
                        "title": "The History of the Guitar",
                        "content": "<em>An overview of the origins of the modern guitar</em>\n\n<strong>A</strong> The earliest stringed instruments currently known to archaeologists are bowl harps. For millennia, people made bowl harps using, for example, tortoise shells as resonators, with a bent stick for a neck and one or more gut or silk strings. The world's museums contain many such harps from the ancient Sumerian, Babylonian, and Egyptian civilisations. Around 2500-2000 BC more advanced harps, such as the beautifully carved 11-stringed instrument found in the tomb of Queen Shub-Ad in ancient Mesopotamia, now modern-day Iraq, started to appear.\n\n<strong>B</strong> The tanbur probably developed from the bowl harp. It was different from the bowl harp in that its neck was straightened out to allow the strings to be pressed down to create more notes. Tomb paintings and stone carvings in Egypt indicate that harps and tanburs - plus flutes and percussion instruments - were being played together 3,500-4,000 years ago. Archaeologists have also found many similar relics amongst the ruins of the ancient Mesopotamian civilisation. Many of these instruments have survived into modern times in almost unchanged form, for example folk instruments of the region such as the Turkish saz and Afghan panchtar.\n\n<strong>C</strong> At 3,500 years old, the tanbur which belonged to the Egyptian singer Har-Mose is the earliest known example of this instrument. Har-Mose's tanbur had three strings and a plectrum suspended from the neck by a cord. The soundbox, which increased the volume, was made of beautifully polished cedarwood and covered in rawhide. It can be seen today at the Archaeological Museum in Cairo.\n\n<strong>D</strong> In order to distinguish guitars from other stringed instruments, it is helpful to have a broad definition of the guitar. Music expert Dr Michael Kasha defines a guitar as having 'a long, fretted neck, flat wooden soundboard, ribs, and a flat back, most often with sides that curve inwards'. The oldest known visual representation of such an instrument is a stone carving at Alacaa H√ºy√ºk in Turkey, which shows a 3,300-year-old instrument with a long neck and sides that clearly curve inwards.\n\n<strong>E</strong> The name 'guitar' comes from the ancient Sanskrit word for 'string' - 'tar'. Many popular stringed instruments used in central Asia today have existed in an unchanged form for several thousand years, as shown by the archaeological finds in the area. Many have names that end in 'tar', with a prefix indicating the number of strings, such as the dotar, a two-stringed instrument found in Turkestan, and the Persian three-stringed setar and four-stringed chartar. The Indian sitar almost certainly took its name from the setar, but over the centuries it evolved radically, following the Indians' own aesthetic and cultural ideals.\n\n<strong>F</strong> Tanburs and harps spread around the ancient world with travellers, merchants and seamen. The earliest guitar-like instruments to arrive in Europe had, most often, four strings. Many such instruments, and variations with from three to five strings, can be seen in mediaeval illustrated manuscripts. They were also carved in stone in European churches and cathedrals, from the first century AD through until the 13th century.\n\n<strong>G</strong> When the four stringed Persian chartar arrived in Spain, however, it changed in form and construction, acquiring pairs of strings tuned to the same note instead of single strings. It became known as the chitarra. By the middle of the 14th century, the chitarra had become dominant, at least in most of Europe. The earliest known music for the eight-stringed chitarra was written in 16th-century Spain. The ten-string version first appeared in Italy at the same time, and gradually replaced the eight-stringed instrument. A further two strings first appeared in the 17th century, an innovation which guitar makers all over Europe quickly took up. However, this twelve-string arrangement gradually gave way to six single strings across the continent. The six-stringed guitar can thus be said to be a development of the twelve-stringed, rather than vice versa, as was thought previously.\n\n<strong>H</strong> At the beginning of the 19th century, the present-day guitar began to take shape, although bodies were still fairly small and narrow-waisted. The modern classical guitar first appeared in its current form in the mid-19th century, when the Spanish guitar maker Antonio Torres increased the size of the body, altered its proportions, and introduced the revolutionary fan-braced top**. His design radically increased the volume and improved the tone of the instrument and very soon became the norm. This design has remained essentially unchanged to this day.\n\n<strong>I</strong> At the time when Torres made his breakthrough, German immigrants to America - among them Christian Friedrich Martin - began making guitars with X-braced tops. Steel strings, which became widely available several decades later in the early 1900s, offered the promise of much louder guitars, but the increased tension was too much for the fan-braced top. The stronger X-braced top proved equal to the job, and quickly became the industry standard.\n\n<strong>J</strong> At the end of the 19th century, guitar manufacturer Orville Gibson added steel strings to a body constructed like a cello, a combination which produced more volume. The electric guitar was born when pickups were fitted to Hawaiian and jazz guitars in the late 1920s, but met with little success until 1936, when Gibson introduced its famous ES150 model.\n\n* tanbur: a long-necked stringed instrument with a small pear-shaped body\n\n** fan-braced top: a strengthening structure in the shape of a fan inserted into the soundbox"
                    },
                    "questions": [
                        { "id": 1, "type": "TRUE_FALSE_NOT_GIVEN", "text": "The instrument found in Queen Shub-Ad's tomb is the world's oldest known version of a harp.", "options": [{ "value": "true", "label": "TRUE" }, { "value": "false", "label": "FALSE" }, { "value": "not-given", "label": "NOT GIVEN" }], "correctAnswer": "false", "explanation": "FALSE - Paragraph A says bowl harps are the earliest known instruments, while Queen Shub-Ad's harp appeared later (2500‚Äì2000 BC) as a more advanced type." },
                        { "id": 2, "type": "TRUE_FALSE_NOT_GIVEN", "text": "Today's Afghan panchtar is very similar to an ancient Mesopotamian instrument.", "options": [{ "value": "true", "label": "TRUE" }, { "value": "false", "label": "FALSE" }, { "value": "not-given", "label": "NOT GIVEN" }], "correctAnswer": "true", "explanation": "TRUE - Paragraph B says many instruments survived into modern times in almost unchanged form, including the Afghan panchtar." },
                        { "id": 3, "type": "TRUE_FALSE_NOT_GIVEN", "text": "The Egyptian singer Har-Mose was an excellent tanbur player.", "options": [{ "value": "true", "label": "TRUE" }, { "value": "false", "label": "FALSE" }, { "value": "not-given", "label": "NOT GIVEN" }], "correctAnswer": "not-given", "explanation": "NOT GIVEN - Paragraph C describes Har-Mose and his tanbur but gives no information about his skill as a player." },
                        { "id": 4, "type": "TRUE_FALSE_NOT_GIVEN", "text": "Cairo Archaeological Museum contains many historic musical instruments.", "options": [{ "value": "true", "label": "TRUE" }, { "value": "false", "label": "FALSE" }, { "value": "not-given", "label": "NOT GIVEN" }], "correctAnswer": "not-given", "explanation": "NOT GIVEN - Paragraph C only states the tanbur is in the Archaeological Museum in Cairo, not that it contains many historic instruments." },
                        { "id": 5, "type": "TRUE_FALSE_NOT_GIVEN", "text": "The instrument carved in stone at Alacaa H√ºy√ºk is consistent with Dr Michael Kasha's definition of a guitar.", "options": [{ "value": "true", "label": "TRUE" }, { "value": "false", "label": "FALSE" }, { "value": "not-given", "label": "NOT GIVEN" }], "correctAnswer": "true", "explanation": "TRUE - Paragraph D links Kasha's definition to the Alacaa H√ºy√ºk carving, which shows a long neck and inward-curving sides." },
                        { "id": 6, "type": "TRUE_FALSE_NOT_GIVEN", "text": "The different instruments that appeared in mediaeval literature had the same number of strings.", "options": [{ "value": "true", "label": "TRUE" }, { "value": "false", "label": "FALSE" }, { "value": "not-given", "label": "NOT GIVEN" }], "correctAnswer": "false", "explanation": "FALSE - Paragraph F states the instruments varied from three to five strings." },
                        { "id": 7, "type": "GAP_FILL", "text": "was a development of an earlier instrument called the 7 .....................", "correctAnswer": "chartar", "explanation": "Paragraph G: the four-stringed Persian chartar arrived in Spain and became known as the chitarra." },
                        { "id": 8, "type": "GAP_FILL", "text": "its shape a result of modifications including a larger 8 ..................... introduced by Antonio Torres", "correctAnswer": "body", "explanation": "Paragraph H: Antonio Torres increased the size of the body." },
                        { "id": 9, "type": "GAP_FILL", "text": "changes produced better tone and greater 9 .....................", "correctAnswer": "volume", "explanation": "Paragraph H: his design increased the volume and improved the tone." },
                        { "id": 10, "type": "GAP_FILL", "text": "first made in 10 ..................... in mid-19th century", "correctAnswer": "America", "explanation": "Paragraph I: German immigrants to America began making guitars with X-braced tops." },
                        { "id": 11, "type": "GAP_FILL", "text": "strings made of 11 ..................... became available around 1900", "correctAnswer": "steel", "explanation": "Paragraph I: steel strings became widely available in the early 1900s." },
                        { "id": 12, "type": "GAP_FILL", "text": "in the 1920s, 12 ..................... added to guitars", "correctAnswer": "pickups", "explanation": "Paragraph J: pickups were fitted to Hawaiian and jazz guitars in the late 1920s." },
                        { "id": 13, "type": "GAP_FILL", "text": "a well-known version brought out by 13 .....................", "correctAnswer": "Gibson", "explanation": "Paragraph J: Gibson introduced its famous ES150 model." }
                    ]
                },
                {
                    "id": 2,
                    "title": "Part 2",
                    "instructions": "You should spend about 20 minutes on Questions 14-26, which are based on Reading Passage 2.",
                    "questionRange": "14-26",
                    "passage": {
                        "title": "Playing Soccer",
                        "content": "<strong>A</strong> Street soccer, as its name implies, is an informal variation of the sport, often played on the street, particularly in urban areas. There are many reasons for the widespread popularity of street soccer. Unlike youth soccer, its more formally organized counterpart, no large space is needed, and goal posts, corner markers, and marked lines, associated with the formal game, are typically absent, as are game officials or referees. Another attraction of street soccer is that it is played frequently and competitively, but does not necessarily require standard 11-a-side teams or fixed playing positions. Unlike in youth soccer, inexperienced street soccer players rarely learn from repetitive technical and tactical drills. Instead, they learn from their poor performance in competition, unconscious of the skills they are nonetheless developing, and without older adults or coaches present. Players learn without effort through playing the game, and soon attain an almost natural feeling for the sport.\n\n<strong>B</strong> However, there are lots of cities in the world today where conditions are such that street soccer is no longer possible. Congested traffic now dominates where games were once played. Parks and open fields are used as hangouts for teenagers with other interests. Add to this the requirement in many localities for official permits to use public spaces and the managed schedules that many young people have today, and spontaneous play of any kind is hard to imagine.\n\n<strong>C</strong> In spite of all these obstacles, which are probably solvable in most instances, there is another sociological explanation of why in many places street soccer doesn't enjoy the same popularity it once did. In his book <em>How Soccer Explains the World</em>, US writer Franklin Foer observes: 'But for all the talk of freedom, the 1960s parenting style had a far less relaxed side too. Like the 1960s consumer movement which brought seat belts and airbags to cars, the (youth) soccer movement felt like it could create a set of ... regulations that would protect both the child's body and mind from damage.' Soccer leagues like the one I played in as a child handed out 'participation' prizes to every player, no matter how few games his (or her) team won. Where most of the world accepts the practice of using your head to hit the ball as an essential element of the game, some (youth) soccer parents have worried over the potential for injury to the brain. An entire industry grew up to manufacture protective headgear. Even though very little medical evidence supports this fear, some youth leagues prohibited heading the ball altogether.\n\n<strong>D</strong> A growing body of people don't believe street soccer involves a legitimate educational method. They argue that children need to be taught by experts. Youth soccer instruction now begins with four-year-olds, so that they will have an advantage as six-year-olds. This need to get ahead brings with it a fear of falling behind that only expert instruction can prevent. This type of instruction leaves no room for the trial and error approach of street soccer.\n\n<strong>E</strong> One of the basic ideas of street soccer is that young players are assigned a particular role by a better player and are expected to play for the good of the team. Such an assignment runs counter to the idea of youth soccer that every child needs to learn every position and will benefit from doing so. In street soccer, you fill the role that you are best suited to at a particular time. While this role assignment can change from game to game, the purpose is always the same: to get the best out of each individual at any given moment.\n\n<strong>F</strong> In street soccer, children have to learn patience, to wait their turn, to realize that they are not entitled to make decisions, or even be listened to simply because they speak up. Positions of responsibility are earned through competition within the team. Younger players in street soccer must wait to attain those positions. In youth soccer, however, with its overly democratic values, youngsters are guaranteed their time in the spotlight. Whether it's their turn to be captain, to play a central position or to take a crucial shot, youth soccer players come to believe that hard work and patience aren't really necessary.\n\n<strong>G</strong> Not only does every youth soccer player get a chance, it is assumed that each individual has played well. 'Everyone's a winner; no one's a loser' is a guiding principle of youth soccer. This ensures each individual goes away positive about themselves. No one can leave a game or a practice feeling bad. But if there really are no losers, then why try at all? Since giving less than your best receives the same reward as giving your best, why go to any extra effort? In street soccer, every game results in a winner and a loser and everyone knows who is who. Losing a game is a common experience and players learn early on how to handle this. As a result, unlike most youth soccer players, they acquire resilience. A further difference between these two strands of soccer is that in street soccer a formal record is not kept. You can lose one day and win the next. The results are only temporary and are forgotten within minutes of the end of the match. But in organized youth soccer, the position each person plays and the results are formally noted and maintained throughout a season."
                    },
                    "questions": [
                        { "id": 14, "type": "PARAGRAPH_SELECTION", "text": "a contrast between the ways young players gain experience of playing different positions", "correctAnswer": "E", "explanation": "Paragraph E contrasts role assignment in street soccer with the youth-soccer idea that every child should learn every position." },
                        { "id": 15, "type": "PARAGRAPH_SELECTION", "text": "examples outside sport of greater emphasis on individual safety", "correctAnswer": "C", "explanation": "Paragraph C mentions seat belts and airbags as non-sport examples of increased safety emphasis." },
                        { "id": 16, "type": "PARAGRAPH_SELECTION", "text": "a description of methods of selection for leadership on soccer teams", "correctAnswer": "F", "explanation": "Paragraph F explains that positions of responsibility (e.g., captain) are earned through competition within the team." },
                        { "id": 17, "type": "PARAGRAPH_SELECTION", "text": "details of urban changes that discourage street soccer", "correctAnswer": "B", "explanation": "Paragraph B lists congested traffic, use of parks, permit requirements, and managed schedules as obstacles." },
                        { "id": 18, "type": "PARAGRAPH_SELECTION", "text": "a mention of the lesson that failure teaches street soccer players", "correctAnswer": "G", "explanation": "Paragraph G notes that losing is common and teaches players resilience." },
                        { "id": 19, "type": "PARAGRAPH_SELECTION", "text": "an explanation of why youth soccer emphasises the need for coaches", "correctAnswer": "D", "explanation": "Paragraph D says expert instruction is demanded due to fear of falling behind." },
                        { "id": 20, "type": "MULTIPLE_CHOICE_MULTI", "text": "The list below gives some possible reasons for the popularity of street soccer. Which TWO of these reasons are mentioned by the writer of the text?", "options": [
                            { "value": "A", "label": "A Many famous soccer players got their start in street soccer." },
                            { "value": "B", "label": "B Young people can begin playing street soccer at a very early age." },
                            { "value": "C", "label": "C You do not need elaborate facilities to play street soccer." },
                            { "value": "D", "label": "D Inexperienced street soccer players are not criticised for mistakes." },
                            { "value": "E", "label": "E Street soccer teams can have varying numbers of players." }
                        ], "correctAnswer": ["C", "E"], "explanation": "Paragraph A notes no large space or formal facilities are needed and teams need not be standard 11-a-side." },
                        { "id": 22, "type": "MULTIPLE_CHOICE_MULTI", "text": "The list below gives some possible results of the 1960s parenting style. Which TWO of these results are mentioned by Franklin Foer in the excerpt from How Soccer Explains the World?", "options": [
                            { "value": "A", "label": "A Participation in youth soccer became much more expensive." },
                            { "value": "B", "label": "B Some youth soccer leagues adopted more restrictive rules of play." },
                            { "value": "C", "label": "C Fewer young people joined youth soccer teams." },
                            { "value": "D", "label": "D Youth soccer players were sometimes rewarded for simply playing in games." },
                            { "value": "E", "label": "E Soccer equipment manufacturers directed advertising towards parents." }
                        ], "correctAnswer": ["B", "D"], "explanation": "Paragraph C mentions restrictive rules like banning heading and participation prizes for all players." },
                        { "id": 24, "type": "GAP_FILL", "text": "For youth soccer players, a key 24 ..................... is that they should always come away from the game with a positive attitude.", "correctAnswer": "principle", "explanation": "Paragraph G: 'Everyone's a winner; no one's a loser' is described as a guiding principle." },
                        { "id": 25, "type": "GAP_FILL", "text": "In this respect, regardless of the effort the players make, they get some kind of 25 ..................... at the end of a game.", "correctAnswer": "reward", "explanation": "Paragraph G: giving less than your best receives the same reward as giving your best." },
                        { "id": 26, "type": "GAP_FILL", "text": "In fact, no-one ever keeps a 26 ..................... of the results of games.", "correctAnswer": "record", "explanation": "Paragraph G: in street soccer a formal record is not kept." }
                    ]
                },
                {
                    "id": 3,
                    "title": "Part 3",
                    "instructions": "You should spend about 20 minutes on Questions 27-40, which are based on Reading Passage 3.",
                    "questionRange": "27-40",
                    "passage": {
                        "title": "Memory Champions ... or just good at tricks?",
                        "intro": "",
                        "content": "<strong>A</strong> The Examinations School at Oxford University is where, last August, 34 contestants gathered at the World Memory Championships. It is an impressive historical venue, known for its austere yet grandiose setting of oak-paneled rooms, large Gothic windows, and looming portraits of eminent dukes and earls. It is here that generations of Oxford students have been tested in their final exams on their memory and knowledge, and it is here that these contestants were challenged to demonstrate their exceptional mnemonic abilities. Reciting poems, memorizing digit sequences, and recalling faces from photographs are just a few of the tasks that test the limits of human memory in this competitive setting.\n\n<strong>B</strong> They are using a technique known as the loci method, reportedly originating in 477 BC with the Greek poet Simonides of Ceos. He was able to memorize the guest list at a dinner by closing his eyes and recalling each individual around the table. The loci method, which was rediscovered and popularized by Simonides, has become an integral part of historical and modern memory training. This method involves associating items to be remembered with specific physical locations, creating a mental map that facilitates recall. After Simonides's discovery, the loci method became widely embraced across ancient Greece, serving as a fundamental technique for orators and scholars. It was so effective that it was incorporated into educational curricula and became a cornerstone of rhetorical training. Aristotle wrote favorably about it, recognizing its value and effectiveness. Later, a number of treatises on the art of memory were published in Rome, further cementing its importance and utility in memory training. This method not only aids in memorization but also enhances the ability to retrieve information by navigating through these mental loci, effectively walking through a structured memory palace.\n\n<strong>C</strong> One memory champion, Ed Cooke, can memorize the order of ten decks of playing cards in less than one hour or one deck of cards in less than one minute. Psychologists Elizabeth Valentine and John Wilding have teamed up with Eleanor Maguire to study how memory champions like Cooke operate differently from average individuals. Their collaboration aims to explore the neural underpinnings that might explain the exceptional memory skills exhibited by competitors in high-pressure environments such as memory championships. When the researchers analyzed the brain scans from the number memorization, they found that the memory champions were activating some brain regions that were different from those the control subjects were using. These regions are known to be involved in visual memory and spatial navigation.\n\n<strong>D</strong> To enable himself to memorize quickly, Ed Cooke has memorized a specific human being, verb, and object that he associates with every card in the deck. This detailed and highly personalized system allows him to rapidly encode and decode information during competitions. When Cooke commits a deck to memory, he does it three cards in one go, with every three-card group forming a composite picture of a person doing something to an object. This method not only enhances the memorization process but also makes the recall process faster and more efficient. He then places those images along a specific familiar path in his mind, creating a vivid mental journey that he can easily traverse. When it comes to recall, Cooke takes a mental walk along his route and translates the images into cards, effectively and efficiently converting his vivid mental images back into the specific order of the deck. This innovative approach to memory exercises showcases the extraordinary capabilities of mental athletes and the sophisticated strategies they employ to achieve their remarkable feats.\n\n<strong>E</strong> The term 'photographic memory' is frequently used to describe people with exceptional recall. Yet, most researchers agree there is no proof that such a memory truly exists. If it is indeed a myth, it highlights how learned strategies are often more effective than natural talent. The belief in 'photographic memory' remains a point of contention among the public and scientists alike. Despite the absence of solid scientific evidence, this myth endures, reflecting how society's fascination with remarkable memory tends to ignore the practical techniques and training that genuinely drive mnemonic success.\n\n<strong>F</strong> The most renowned of the naturals was the Russian journalist S.V. Shereshevski, who could remember long sequences of numbers learned decades before, as well as poems, strings of meaningless syllables, and nearly anything else he was asked to recall. Shereshevski also experienced synesthesia, a rare sensory condition where the senses are interconnected, which significantly improved his memorization ability. His skills were not limited to these accomplishments; his remarkable memory covered an almost endless range of information, making him a figure of great interest and study. This synesthetic trait not only made his memorization tasks easier but also more vivid and long-lasting. His case has been extensively examined, as it offers deep insights into the potential of human memory when enhanced by neurological variations.\n\n<strong>G</strong> K. Anders Ericsson, a well-known psychologist, claims that anyone can develop memory abilities comparable to those of memory champions through consistent practice and proper techniques. During two years of experimentation, S.V. increased his ability to recall numbers from seven to over eighty. This study led Ericsson to conclude that there is no such thing as an innately superior memory. When he revisited original case reports of natural memorizers, he discovered that their remarkable abilities were actually based on the use of specific techniques ‚Äî sometimes unconsciously ‚Äî combined with extensive practice. Strategists are usually outstanding at remembering only certain kinds of material, whereas naturals exhibit strong memory across many types of tasks and can retain those memories more easily."
                    },
                    "questions": [
                        { "id": 27, "type": "PARAGRAPH_SELECTION", "text": "a description of how a contestant remembers complex sequences", "correctAnswer": "D", "explanation": "Paragraph D details Ed Cooke‚Äôs person-verb-object system for remembering card sequences." },
                        { "id": 28, "type": "PARAGRAPH_SELECTION", "text": "an example of how one person‚Äôs memory was improved over time", "correctAnswer": "G", "explanation": "Paragraph G notes S.V. increased recall from seven to over eighty through two years of training." },
                        { "id": 29, "type": "PARAGRAPH_SELECTION", "text": "a description of a memorizing competition", "correctAnswer": "A", "explanation": "Paragraph A describes the World Memory Championships and the contest setting." },
                        { "id": 30, "type": "PARAGRAPH_SELECTION", "text": "a commonly held belief about memory that many experts say is unproven", "correctAnswer": "E", "explanation": "Paragraph E says 'photographic memory' is commonly believed but lacks proof." },
                        { "id": 31, "type": "PARAGRAPH_SELECTION", "text": "a reference to the first recorded use of memorizing through location", "correctAnswer": "B", "explanation": "Paragraph B mentions Simonides of Ceos and the origins of the loci method in 477 BC." },
                        { "id": 32, "type": "PARAGRAPH_SELECTION", "text": "a reference to an unusual condition which results in improved memory", "correctAnswer": "F", "explanation": "Paragraph F describes synesthesia, a rare condition that enhanced Shereshevski‚Äôs memory." },
                        { "id": 33, "type": "GAP_FILL", "text": "A 33 ............, an action, and a thing are assigned to consecutive cards in the pack.", "correctAnswer": "specific human being", "explanation": "Paragraph D: Cooke assigns a specific human being, a verb, and an object to cards." },
                        { "id": 34, "type": "GAP_FILL", "text": "Combining these images allows Cooke to memorise 34 ............ at a time.", "correctAnswer": "three cards", "explanation": "Paragraph D: he memorizes three cards in one go by combining the images." },
                        { "id": 35, "type": "GAP_FILL", "text": "The mind pictures are then positioned on a 35 ............ .", "correctAnswer": "specific familiar path", "explanation": "Paragraph D: the images are placed along a specific familiar path." },
                        { "id": 36, "type": "GAP_FILL", "text": "The pack of cards is remembered by going for a 36 ............ while the pictures are converted back into cards.", "correctAnswer": "mental walk", "explanation": "Paragraph D: Cooke takes a mental walk along his route to recall the cards." },
                        { "id": 37, "type": "MATCHING", "text": "Valentine, Wilding and Maguire‚Äôs experiment shows that the memory contestants", "options": [{ "value": "A", "label": "A used mainly for educational purposes." }, { "value": "B", "label": "B activated brain areas associated with visual and spatial memory." }, { "value": "C", "label": "C became widespread in ancient Greece for memorizing speeches and texts." }, { "value": "D", "label": "D the result of techniques and extensive practice." }, { "value": "E", "label": "E retaining a wide variety of tasks." }, { "value": "F", "label": "F benefited from additional cognitive abilities." }], "correctAnswer": "B", "explanation": "Paragraph C reports activation of brain regions involved in visual memory and spatial navigation." },
                        { "id": 38, "type": "MATCHING", "text": "After Simonides discovered the loci method in 477 BC, it was", "options": [{ "value": "A", "label": "A used mainly for educational purposes." }, { "value": "B", "label": "B activated brain areas associated with visual and spatial memory." }, { "value": "C", "label": "C became widespread in ancient Greece for memorizing speeches and texts." }, { "value": "D", "label": "D the result of techniques and extensive practice." }, { "value": "E", "label": "E retaining a wide variety of tasks." }, { "value": "F", "label": "F benefited from additional cognitive abilities." }], "correctAnswer": "C", "explanation": "Paragraph B says the loci method became widely embraced across ancient Greece for orators and scholars." },
                        { "id": 39, "type": "MATCHING", "text": "Ericsson finds out that natural memorizers are better than strategic memorizers at", "options": [{ "value": "A", "label": "A used mainly for educational purposes." }, { "value": "B", "label": "B activated brain areas associated with visual and spatial memory." }, { "value": "C", "label": "C became widespread in ancient Greece for memorizing speeches and texts." }, { "value": "D", "label": "D the result of techniques and extensive practice." }, { "value": "E", "label": "E retaining a wide variety of tasks." }, { "value": "F", "label": "F benefited from additional cognitive abilities." }], "correctAnswer": "E", "explanation": "Paragraph G contrasts naturals as strong across many types of tasks, unlike strategists." },
                        { "id": 40, "type": "MATCHING", "text": "According to K. Anders Ericsson, Shereshevski‚Äôs skills were", "options": [{ "value": "A", "label": "A used mainly for educational purposes." }, { "value": "B", "label": "B activated brain areas associated with visual and spatial memory." }, { "value": "C", "label": "C became widespread in ancient Greece for memorizing speeches and texts." }, { "value": "D", "label": "D the result of techniques and extensive practice." }, { "value": "E", "label": "E retaining a wide variety of tasks." }, { "value": "F", "label": "F benefited from additional cognitive abilities." }], "correctAnswer": "D", "explanation": "Paragraph G states the remarkable abilities were based on techniques plus extensive practice." }
                    ]
                }
            ]
        };

        // Application State
        let currentPart = 1;
        let answers = {};
        let leftPanelWidth = 50;
        let isDragging = false;
        let highlights = {}; // Store highlights per part: { partId: [highlights] }
        let highlightButton = { show: false, x: 0, y: 0, selectedRange: null };
        let clearHighlightButton = { show: false, x: 0, y: 0, highlightId: null };

        // Timer State
        let timeRemaining = testData.duration * 60; // in seconds
        let isTimerRunning = false;
        let timerInterval = null;

        // Timer Functions
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            document.getElementById('timer-text').textContent = formatTime(timeRemaining);
        }

        function startTimer() {
            isTimerRunning = true;
            updateTimerIcons();
            if (timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 0) {
                    stopTimer();
                    alert("Time's up! Your test will be submitted automatically.");
                    submitTest();
                }
            }, 1000);
        }

        function stopTimer() {
            isTimerRunning = false;
            updateTimerIcons();
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function toggleTimer() {
            if (isTimerRunning) {
                stopTimer();
            } else {
                startTimer();
            }
        }

        function updateTimerIcons() {
            const playIcon = document.getElementById('play-icon');
            const pauseIcon = document.getElementById('pause-icon');

            if (isTimerRunning) {
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
            } else {
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
            }
        }

        // Panel Resizing
        function handleMouseDown(e) {
            isDragging = true;
            e.preventDefault();
        }

        function handleMouseMove(e) {
            if (!isDragging) return;

            const container = document.getElementById('main-container');
            const containerRect = container.getBoundingClientRect();
            const newWidth = ((e.clientX - containerRect.left) / containerRect.width) * 100;

            // Constrain between 20% and 80%
            const constrainedWidth = Math.max(20, Math.min(80, newWidth));
            leftPanelWidth = constrainedWidth;

            document.getElementById('left-panel').style.width = `${leftPanelWidth}%`;
            document.getElementById('right-panel').style.width = `${100 - leftPanelWidth}%`;
        }

        function handleMouseUp() {
            isDragging = false;
        }

        // Text Highlighting
        function addHighlight() {
            if (!highlightButton.selectedRange) return;

            const targetRange = highlightButton.selectedRange;
            const selectedText = targetRange.toString().trim();

            if (selectedText.length === 0) {
                hideHighlightButton();
                return;
            }

            if (targetRange.startContainer !== targetRange.endContainer) {
                hideHighlightButton();
                return;
            }

            if (targetRange.startContainer.nodeType !== Node.TEXT_NODE) {
                hideHighlightButton();
                return;
            }

            const highlightId = `highlight-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

            try {
                const highlightSpan = document.createElement('span');
                highlightSpan.setAttribute('data-highlight-id', highlightId);
                highlightSpan.id = highlightId;
                highlightSpan.className = 'bg-yellow-300 cursor-pointer';

                // Add click event to show clear button (same as restored highlights)
                highlightSpan.addEventListener('click', (e) => {
                    e.preventDefault();
                    showClearHighlightButton(e.pageX, e.pageY, highlightId);
                });

                highlightSpan.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    showClearHighlightButton(e.clientX + 10, e.clientY - 35, highlightId);
                });

                // Add double-click to remove highlight directly
                highlightSpan.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    removeHighlight(highlightId);
                });

                const contents = targetRange.extractContents();
                highlightSpan.appendChild(contents);
                targetRange.insertNode(highlightSpan);

                // Store highlight data per part
                if (!highlights[currentPart]) {
                    highlights[currentPart] = [];
                }

                // Find where this highlight belongs
                const passageContent = document.getElementById('passage-content');
                const questionsContainer = document.getElementById('questions-container');
                let isInPassage = false;
                let isInQuestions = false;
                let elementIndex = -1;

                // Check if it's in the passage content
                let paragraph = targetRange.startContainer;
                while (paragraph && paragraph.tagName !== 'P' && paragraph.parentElement) {
                    paragraph = paragraph.parentElement;
                }

                if (paragraph && paragraph.tagName === 'P' && passageContent.contains(paragraph)) {
                    isInPassage = true;
                    elementIndex = Array.from(passageContent.children).indexOf(paragraph);
                } else if (questionsContainer.contains(targetRange.startContainer)) {
                    // For questions, find any parent element that contains the text
                    let element = targetRange.startContainer;
                    while (element && element !== questionsContainer && element.parentElement) {
                        if (element.parentElement === questionsContainer || 
                            (element.children && element.children.length > 0)) {
                            isInQuestions = true;
                            // Store the text content as identifier for questions
                            elementIndex = selectedText; // Use the selected text as the identifier for questions
                            break;
                        }
                        element = element.parentElement;
                    }
                }

                if (!isInPassage && !isInQuestions) {
                    throw new Error('Highlighting not supported in this area');
                }

                // Create separate storage for question highlights
                if (!highlights[currentPart]) {
                    highlights[currentPart] = [];
                }
                if (!window.questionHighlights) {
                    window.questionHighlights = {};
                }
                if (!window.questionHighlights[currentPart]) {
                    window.questionHighlights[currentPart] = [];
                }

                if (isInPassage) {
                    highlights[currentPart].push({
                        id: highlightId,
                        text: selectedText,
                        paragraphIndex: elementIndex
                    });
                } else if (isInQuestions) {
                    window.questionHighlights[currentPart].push({
                        id: highlightId,
                        text: selectedText,
                        identifier: elementIndex
                    });
                }

                window.getSelection()?.removeAllRanges();
                hideHighlightButton();
            } catch (error) {
                console.warn('Could not highlight selected text:', error);
                hideHighlightButton();
            }
        }

        function removeHighlight(highlightId) {
            const highlightElement = document.getElementById(highlightId);
            
            if (highlightElement) {
                const parent = highlightElement.parentNode;
                if (parent) {
                    const textNode = document.createTextNode(highlightElement.textContent || '');
                    parent.replaceChild(textNode, highlightElement);
                    parent.normalize();
                }
            }

            // Remove highlight from passage highlights
            if (highlights[currentPart]) {
                highlights[currentPart] = highlights[currentPart].filter(h => h.id !== highlightId);
            }

            // Remove highlight from question highlights
            if (window.questionHighlights && window.questionHighlights[currentPart]) {
                window.questionHighlights[currentPart] = window.questionHighlights[currentPart].filter(h => h.id !== highlightId);
            }

            hideClearHighlightButton();
        }

        function showHighlightButton(x, y, range) {
            const button = document.getElementById('highlight-button');
            button.style.left = `${Math.max(10, Math.min(window.innerWidth - 110, x))}px`;
            button.style.top = `${Math.max(10, y)}px`;
            button.classList.remove('hidden');

            highlightButton = { show: true, x, y, selectedRange: range };
        }

        function hideHighlightButton() {
            document.getElementById('highlight-button').classList.add('hidden');
            highlightButton = { show: false, x: 0, y: 0, selectedRange: null };
        }

        function showClearHighlightButton(x, y, highlightId) {
            const button = document.getElementById('clear-highlight-button');
            button.style.left = `${x}px`;
            button.style.top = `${y}px`;
            button.classList.remove('hidden');

            clearHighlightButton = { show: true, x, y, highlightId };
        }

        function hideClearHighlightButton() {
            document.getElementById('clear-highlight-button').classList.add('hidden');
            clearHighlightButton = { show: false, x: 0, y: 0, highlightId: null };
        }

        function restoreHighlights() {
            // Wait a brief moment for DOM to be ready
            setTimeout(() => {
                // Restore passage highlights
                restorePassageHighlights();
                // Restore question highlights
                restoreQuestionHighlights();
            }, 200);
        }

        function restorePassageHighlights() {
            const passageContent = document.getElementById('passage-content');
            if (!highlights[currentPart] || highlights[currentPart].length === 0) {
                return;
            }

            // Group highlights by paragraph
            const highlightsByParagraph = {};
            highlights[currentPart].forEach(highlight => {
                if (!highlightsByParagraph[highlight.paragraphIndex]) {
                    highlightsByParagraph[highlight.paragraphIndex] = [];
                }
                highlightsByParagraph[highlight.paragraphIndex].push(highlight);
            });

            const paragraphs = Array.from(passageContent.children);

            // Process each paragraph that has highlights
            Object.keys(highlightsByParagraph).forEach(paragraphIndex => {
                const paragraphHighlights = highlightsByParagraph[paragraphIndex];
                const paraIndex = parseInt(paragraphIndex);

                if (paraIndex >= 0 && paraIndex < paragraphs.length) {
                    const paragraph = paragraphs[paraIndex];
                    let text = paragraph.textContent;

                    // Sort highlights by their position in the text (earliest first)
                    const sortedHighlights = paragraphHighlights
                        .map(h => ({ ...h, index: text.indexOf(h.text) }))
                        .filter(h => h.index !== -1)
                        .sort((a, b) => a.index - b.index);

                    if (sortedHighlights.length > 0) {
                        paragraph.innerHTML = '';
                        let currentPosition = 0;

                        sortedHighlights.forEach((highlight, i) => {
                            // Add text before highlight
                            if (highlight.index > currentPosition) {
                                const beforeText = text.substring(currentPosition, highlight.index);
                                paragraph.appendChild(document.createTextNode(beforeText));
                            }

                            // Add highlighted span
                            const highlightSpan = document.createElement('span');
                            highlightSpan.className = 'bg-yellow-300 cursor-pointer';
                            highlightSpan.textContent = highlight.text;
                            highlightSpan.id = highlight.id;

                            highlightSpan.addEventListener('click', function(e) {
                                e.preventDefault();
                                showClearHighlightButton(e.pageX, e.pageY, highlight.id);
                            });

                            // Add double-click to remove highlight directly
                            highlightSpan.addEventListener('dblclick', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                removeHighlight(highlight.id);
                            });

                            paragraph.appendChild(highlightSpan);
                            currentPosition = highlight.index + highlight.text.length;
                        });

                        // Add remaining text after last highlight
                        if (currentPosition < text.length) {
                            const remainingText = text.substring(currentPosition);
                            paragraph.appendChild(document.createTextNode(remainingText));
                        }
                    }
                }
            });
        }

        function restoreQuestionHighlights() {
            const questionsContainer = document.getElementById('questions-container');
            if (!window.questionHighlights || !window.questionHighlights[currentPart] || 
                window.questionHighlights[currentPart].length === 0) {
                return;
            }

            // Get all text nodes in the questions container
            const walker = document.createTreeWalker(
                questionsContainer,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );

            window.questionHighlights[currentPart].forEach(highlight => {
                // Search for the highlight text in the questions container
                walker.currentNode = questionsContainer;
                let textNode;

                while (textNode = walker.nextNode()) {
                    const text = textNode.textContent;
                    const index = text.indexOf(highlight.text);

                    if (index !== -1) {
                        // Found the text - create highlight
                        const beforeText = text.substring(0, index);
                        const afterText = text.substring(index + highlight.text.length);

                        const highlightSpan = document.createElement('span');
                        highlightSpan.className = 'bg-yellow-300 cursor-pointer';
                        highlightSpan.textContent = highlight.text;
                        highlightSpan.id = highlight.id;

                        highlightSpan.addEventListener('click', function(e) {
                            e.preventDefault();
                            showClearHighlightButton(e.pageX, e.pageY, highlight.id);
                        });

                        // Add double-click to remove highlight directly
                        highlightSpan.addEventListener('dblclick', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            removeHighlight(highlight.id);
                        });

                        // Replace the text node with before + highlight + after
                        const parentNode = textNode.parentNode;
                        if (beforeText) {
                            parentNode.insertBefore(document.createTextNode(beforeText), textNode);
                        }
                        parentNode.insertBefore(highlightSpan, textNode);
                        if (afterText) {
                            parentNode.insertBefore(document.createTextNode(afterText), textNode);
                        }
                        parentNode.removeChild(textNode);

                        // Reset walker since we modified the DOM
                        break;
                    }
                }
            });
        }

        // Content Loading
        function loadPart(partId) {
            const part = testData.parts.find(p => p.id === partId);
            if (!part) return;

            // Update currentPart
            currentPart = partId;

            // Update header
            document.getElementById('part-title').textContent = part.title;
            document.getElementById('part-instructions').textContent = part.instructions;
            document.getElementById('passage-title').textContent = part.passage.title;

            // Update passage content
            const passageContent = document.getElementById('passage-content');
            passageContent.innerHTML = '';

            // Add intro text if present (Part 3 has intro)
            if (part.passage.intro) {
                const introP = document.createElement('p');
                introP.className = 'mb-4 italic text-gray-700';
                introP.innerHTML = part.passage.intro;
                passageContent.appendChild(introP);
            }

            const paragraphs = part.passage.content.split('\n\n');
            paragraphs.forEach((paragraph, index) => {
                if (paragraph.trim()) {
                    const p = document.createElement('p');
                    p.className = 'mb-4';
                    p.innerHTML = paragraph;
                    passageContent.appendChild(p);
                }
            });

            // Restore highlights for this part
            restoreHighlights();

            // Load questions
            loadQuestions(part);

            // For Part 2, setup drag-drop on passage zones
            if (part.id === 2) {
                setTimeout(() => {
                    setupPassageDragDrop(part);
                }, 0);
            }

            // Update navigation
            updateNavigation();
        }

        function setupPassageDragDrop(part) {
            const headingOptions = part.questions.filter(q => q.type === "PARAGRAPH_INFO_MATCHING")[0]?.options || [];
            
            function setupDragHeading(heading) {
                heading.addEventListener('dragstart', (e) => {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('heading-value', heading.dataset.headingValue);
                    e.dataTransfer.setData('heading-label', heading.dataset.headingLabel);
                    e.dataTransfer.setData('heading-text', heading.dataset.headingText);
                    e.dataTransfer.setData('source-element', 'heading-list');
                    heading.style.opacity = '0.5';
                });
                
                heading.addEventListener('dragend', () => {
                    heading.style.opacity = '1';
                });
            }
            
            // Setup initial drag headings from list
            const dragHeadings = document.querySelectorAll('.drag-heading');
            dragHeadings.forEach(heading => {
                setupDragHeading(heading);
            });
            
            const dropZones = document.querySelectorAll('.drop-zone-passage');
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    zone.classList.add('bg-blue-100', 'border-blue-500');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('bg-blue-100', 'border-blue-500');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('bg-blue-100', 'border-blue-500');
                    
                    const headingValue = e.dataTransfer.getData('heading-value');
                    const headingLabel = e.dataTransfer.getData('heading-label');
                    const headingText = e.dataTransfer.getData('heading-text');
                    const sourceElement = e.dataTransfer.getData('source-element');
                    const questionId = parseInt(zone.dataset.question);
                    
                    // If dropping from list, hide that heading from options
                    if (sourceElement === 'heading-list') {
                        const dragHeading = document.querySelector(`.drag-heading[data-heading-value="${headingValue}"]`);
                        if (dragHeading) {
                            dragHeading.style.display = 'none';
                        }
                    }
                    
                    answers[questionId] = headingValue;
                    zone.classList.remove('border-dashed', 'bg-gray-50');
                    zone.classList.add('border-solid', 'bg-white', 'border-gray-400', 'drag-from-zone');
                    zone.draggable = true;
                    zone.innerHTML = `<span class="text-gray-800 font-medium cursor-grab hover:text-blue-600" title="Drag to move to another section">${headingText}</span>`;
                    zone.style.cursor = 'grab';
                    
                    // Make the drop zone draggable to move it elsewhere
                    zone.addEventListener('dragstart', (evt) => {
                        evt.dataTransfer.effectAllowed = 'move';
                        evt.dataTransfer.setData('heading-value', headingValue);
                        evt.dataTransfer.setData('heading-label', headingLabel);
                        evt.dataTransfer.setData('heading-text', headingText);
                        evt.dataTransfer.setData('source-element', 'drop-zone');
                        evt.dataTransfer.setData('source-zone-id', zone.dataset.question);
                        zone.style.opacity = '0.5';
                    });
                    
                    zone.addEventListener('dragend', () => {
                        zone.style.opacity = '1';
                    });
                    
                    updateQuestionIndicators();
                });
            });
            
            // Allow dropping back on the heading list area
            const headingBox = document.querySelector('.border-2.border-gray-400.p-3');
            if (headingBox) {
                headingBox.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    headingBox.classList.add('bg-blue-50');
                });
                
                headingBox.addEventListener('dragleave', () => {
                    headingBox.classList.remove('bg-blue-50');
                });
                
                headingBox.addEventListener('drop', (e) => {
                    e.preventDefault();
                    headingBox.classList.remove('bg-blue-50');
                    
                    const headingValue = e.dataTransfer.getData('heading-value');
                    const sourceZoneId = e.dataTransfer.getData('source-zone-id');
                    
                    if (sourceZoneId) {
                        // Retract from zone
                        const zone = document.querySelector(`.drop-zone-passage[data-question="${sourceZoneId}"]`);
                        if (zone) {
                            answers[sourceZoneId] = '';
                            zone.classList.add('border-dashed', 'bg-gray-50');
                            zone.classList.remove('border-solid', 'bg-white', 'border-gray-400');
                            zone.innerHTML = '<span class="text-gray-400">Drop heading here</span>';
                            zone.draggable = false;
                            zone.removeEventListener('dragstart', null);
                            zone.removeEventListener('dragend', null);
                            zone.style.cursor = 'default';
                            
                            // Show heading back in list
                            const dragHeading = document.querySelector(`.drag-heading[data-heading-value="${headingValue}"]`);
                            if (dragHeading) {
                                dragHeading.style.display = 'block';
                            }
                            
                            updateQuestionIndicators();
                        }
                    }
                });
            }
        }

        function setupPart3DragDrop() {
            function setupDragOption(option) {
                option.addEventListener('dragstart', (e) => {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('option-value', option.dataset.optionValue);
                    e.dataTransfer.setData('option-label', option.dataset.optionLabel);
                    e.dataTransfer.setData('source-element', 'option-list');
                    option.style.opacity = '0.5';
                });
                
                option.addEventListener('dragend', () => {
                    option.style.opacity = '1';
                });
            }
            
            // Setup initial drag options from list
            const dragOptions = document.querySelectorAll('.drag-option-part3');
            dragOptions.forEach(option => {
                setupDragOption(option);
            });
            
            // Handle inline drop zones (for new format)
            const inlineDropZones = document.querySelectorAll('.drop-zone-inline');
            inlineDropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    zone.classList.add('bg-yellow-100', 'border-blue-500');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('bg-yellow-100', 'border-blue-500');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('bg-yellow-100', 'border-blue-500');
                    
                    const optionValue = e.dataTransfer.getData('option-value');
                    const optionLabel = e.dataTransfer.getData('option-label');
                    const sourceElement = e.dataTransfer.getData('source-element');
                    const questionId = parseInt(zone.dataset.question);
                    
                    // If dropping from list, hide that option from the list
                    if (sourceElement === 'option-list') {
                        const dragOption = document.querySelector(`.drag-option-part3[data-option-value="${optionValue}"]`);
                        if (dragOption) {
                            dragOption.style.display = 'none';
                        }
                    }
                    
                    answers[questionId] = optionValue;
                    zone.innerHTML = `<span class="text-gray-800 font-semibold text-sm">${optionValue}</span>`;
                    zone.classList.add('bg-white', 'border-gray-600');
                    zone.style.width = '100px';
                    zone.style.height = '32px';
                    zone.style.flexShrink = '0';
                    zone.draggable = true;
                    
                    // Make the drop zone draggable to move it elsewhere
                    zone.addEventListener('dragstart', (evt) => {
                        evt.dataTransfer.effectAllowed = 'move';
                        evt.dataTransfer.setData('option-value', optionValue);
                        evt.dataTransfer.setData('option-label', optionLabel);
                        evt.dataTransfer.setData('source-element', 'drop-zone');
                        evt.dataTransfer.setData('source-zone-id', zone.dataset.question);
                        zone.style.opacity = '0.5';
                    });
                    
                    zone.addEventListener('dragend', () => {
                        zone.style.opacity = '1';
                    });
                    
                    updateQuestionIndicators();
                });
            });
            
            // Handle old drop zones (for backward compatibility)
            const dropZones = document.querySelectorAll('.drop-zone-answer');
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    zone.classList.add('bg-gray-100', 'border-gray-400');
                });
                
                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('bg-gray-100', 'border-gray-400');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('bg-gray-100', 'border-gray-400');
                    
                    const optionValue = e.dataTransfer.getData('option-value');
                    const optionLabel = e.dataTransfer.getData('option-label');
                    const sourceElement = e.dataTransfer.getData('source-element');
                    const questionId = parseInt(zone.dataset.question);
                    
                    // If dropping from list, hide that option from the list
                    if (sourceElement === 'option-list') {
                        const dragOption = document.querySelector(`.drag-option-part3[data-option-value="${optionValue}"]`);
                        if (dragOption) {
                            dragOption.style.display = 'none';
                        }
                    }
                    
                    answers[questionId] = optionValue;
                    zone.classList.remove('border-dashed', 'bg-white');
                    zone.classList.add('border-solid', 'bg-gray-50', 'border-gray-400');
                    zone.innerHTML = `<span class="text-gray-800 font-medium">${optionValue}</span>`;
                    zone.style.cursor = 'grab';
                    
                    // Make the drop zone draggable to move it elsewhere
                    zone.draggable = true;
                    zone.addEventListener('dragstart', (evt) => {
                        evt.dataTransfer.effectAllowed = 'move';
                        evt.dataTransfer.setData('option-value', optionValue);
                        evt.dataTransfer.setData('option-label', optionLabel);
                        evt.dataTransfer.setData('source-element', 'drop-zone');
                        evt.dataTransfer.setData('source-zone-id', zone.dataset.question);
                        zone.style.opacity = '0.5';
                    });
                    
                    zone.addEventListener('dragend', () => {
                        zone.style.opacity = '1';
                    });
                    
                    updateQuestionIndicators();
                });
            });
            
            // Allow dropping back on the options list area
            const optionBox = document.querySelector('#drag-options-part3');
            if (optionBox) {
                optionBox.parentElement.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    optionBox.parentElement.classList.add('bg-blue-50');
                });
                
                optionBox.parentElement.addEventListener('dragleave', () => {
                    optionBox.parentElement.classList.remove('bg-blue-50');
                });
                
                optionBox.parentElement.addEventListener('drop', (e) => {
                    e.preventDefault();
                    optionBox.parentElement.classList.remove('bg-blue-50');
                    
                    const optionValue = e.dataTransfer.getData('option-value');
                    const sourceZoneId = e.dataTransfer.getData('source-zone-id');
                    
                    if (sourceZoneId) {
                        // Retract from inline zone
                        const inlineZone = document.querySelector(`.drop-zone-inline[data-question="${sourceZoneId}"]`);
                        if (inlineZone) {
                            answers[sourceZoneId] = '';
                            inlineZone.innerHTML = `<span class="text-gray-400 font-semibold text-sm">${sourceZoneId}</span>`;
                            inlineZone.classList.remove('bg-white', 'border-gray-600');
                            inlineZone.draggable = false;
                            
                            // Show option back in list
                            const dragOption = document.querySelector(`.drag-option-part3[data-option-value="${optionValue}"]`);
                            if (dragOption) {
                                dragOption.style.display = 'block';
                            }
                            
                            updateQuestionIndicators();
                            return;
                        }
                        
                        // Retract from old zone
                        const zone = document.querySelector(`.drop-zone-answer[data-question="${sourceZoneId}"]`);
                        if (zone) {
                            answers[sourceZoneId] = '';
                            zone.classList.add('border-dashed', 'bg-gray-50');
                            zone.classList.remove('border-solid', 'bg-white', 'border-gray-400');
                            zone.innerHTML = '<span class="text-gray-400">Drop here</span>';
                            zone.draggable = false;
                            zone.style.cursor = 'grab';
                            
                            // Show option back in list
                            const dragOption = document.querySelector(`.drag-option-part3[data-option-value="${optionValue}"]`);
                            if (dragOption) {
                                dragOption.style.display = 'block';
                            }
                            
                            updateQuestionIndicators();
                        }
                    }
                });
            }
        }

        function loadQuestions(part) {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            // Special handling for Part 1: Dynamic rendering based on question types
            if (part.id === 1) {
                // Questions 1-6: NOTE COMPLETION (table layout, on top)
                const noteQuestions = part.questions.filter(q => q.type === 'NOTE_COMPLETION').sort((a, b) => a.id - b.id);
                if (noteQuestions.length > 0) {
                    const rows = [
                        { date: '1600s', html: 'Early inventors like Papin started to develop boats that relied on steam instead of manpower or wind.' },
                        { date: '1730s', qid: 1 },
                        { date: '1780s', qid: 2 },
                        { date: '',    qid: 3 },
                        { date: 'Early 1800s', html: 'The Charlotte Dundas pulled barges to Glasgow.' },
                        { date: '',    qid: 4 },
                        { date: '',    qid: 5 },
                        { date: '1812 onwards', qid: 6 }
                    ];

                    const tableSection = document.createElement('div');
                    tableSection.className = 'mb-8';
                    tableSection.innerHTML = `
                        <h3 class="font-bold mb-2">Questions 1‚Äì6</h3>
                        <p class="text-sm text-gray-700 mb-2">Complete the table below.</p>
                        <p class="text-sm text-gray-700 mb-4">Write <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                        <table class="w-full text-sm border border-gray-300">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border border-gray-300 p-2 w-28 text-left">Date</th>
                                    <th class="border border-gray-300 p-2 text-left">Event</th>
                                </tr>
                            </thead>
                            <tbody id="part1-table-body"></tbody>
                        </table>
                    `;

                    const tbody = tableSection.querySelector('#part1-table-body');

                    rows.forEach(row => {
                        const tr = document.createElement('tr');
                        tr.className = 'align-top';
                        tr.innerHTML = `
                            <td class="border border-gray-300 p-2 w-28">${row.date || ''}</td>
                            <td class="border border-gray-300 p-2"></td>
                        `;

                        const eventCell = tr.children[1];

                        if (row.qid) {
                            const q = noteQuestions.find(nq => nq.id === row.qid);
                            const partsBlank = q.text.split(/_+/);

                            const wrapper = document.createElement('div');
                            wrapper.className = 'flex flex-wrap items-center gap-1 text-sm';

                            if (partsBlank[0]) wrapper.appendChild(document.createTextNode(partsBlank[0]));

                            const input = document.createElement('input');
                            input.type = 'text';
                            input.className = 'w-32 h-8 border-2 border-gray-400 text-center text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-2';
                            input.placeholder = q.id;
                            input.value = answers[q.id] || '';
                            input.addEventListener('input', (e) => {
                                answers[q.id] = e.target.value;
                                updateQuestionIndicators();
                            });
                            wrapper.appendChild(input);

                            if (partsBlank[1]) wrapper.appendChild(document.createTextNode(partsBlank[1]));

                            eventCell.appendChild(wrapper);
                            tr.id = `question-${q.id}`;
                        } else {
                            eventCell.textContent = row.html;
                        }

                        tbody.appendChild(tr);
                    });

                    container.appendChild(tableSection);
                }

                // Questions 1-6: TRUE/FALSE/NOT GIVEN (replace old table with True/False/Not Given questions)
                const tfQuestions = part.questions.filter(q => q.type === 'TRUE_FALSE_NOT_GIVEN').sort((a, b) => a.id - b.id);
                if (tfQuestions.length > 0) {
                    const tfSection = document.createElement('div');
                    tfSection.className = 'mb-6';
                    tfSection.innerHTML = `
                        <h3 class="font-bold mb-4">Questions ${tfQuestions[0].id}‚Äì${tfQuestions[tfQuestions.length - 1].id}</h3>
                        <p class="text-sm text-gray-700 mb-2">Do the following statements agree with the information given in Reading Passage 1?</p>
                        <p class="text-sm text-gray-700 mb-4"><em>In boxes ${tfQuestions[0].id}‚Äì${tfQuestions[tfQuestions.length - 1].id} below, write</em></p>
                        <table class="w-full text-sm mb-4 border border-gray-300">
                            <tr class="border-b border-gray-300">
                                <td class="border-r border-gray-300 p-2 font-bold">TRUE</td>
                                <td class="p-2">if the statement agrees with the information</td>
                            </tr>
                            <tr class="border-b border-gray-300">
                                <td class="border-r border-gray-300 p-2 font-bold">FALSE</td>
                                <td class="p-2">if the statement contradicts the information</td>
                            </tr>
                            <tr>
                                <td class="border-r border-gray-300 p-2 font-bold">NOT GIVEN</td>
                                <td class="p-2">if there is no information on this</td>
                            </tr>
                        </table>
                    `;
                    
                    const questionsDiv = document.createElement('div');
                    questionsDiv.className = 'space-y-4';

                    tfQuestions.forEach(question => {
                        const questionDiv = document.createElement('div');
                        questionDiv.className = 'flex items-start space-x-3';
                        questionDiv.id = `question-${question.id}`;

                        questionDiv.innerHTML = `
                            <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1 flex-shrink-0">
                                ${question.id}
                            </div>
                            <div class="flex-1">
                                <p class="text-sm mb-2">${question.text}</p>
                                <div class="flex space-x-4">
                                    ${question.options.map(option => `
                                        <label class="flex items-center space-x-2 cursor-pointer">
                                            <input type="radio" name="question-${question.id}" value="${option.value}" 
                                                   ${answers[question.id] === option.value ? 'checked' : ''} 
                                                   class="w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500">
                                            <span class="text-sm">${option.label}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                        `;

                        questionDiv.querySelectorAll('input[type="radio"]').forEach(radio => {
                            radio.addEventListener('change', () => {
                                answers[question.id] = radio.value;
                                updateQuestionIndicators();
                            });
                        });

                        questionsDiv.appendChild(questionDiv);
                    });

                    tfSection.appendChild(questionsDiv);
                    container.appendChild(tfSection);
                }

                // Questions 7-13: GAP FILL (Complete the notes)
                const gapFillQuestions = part.questions.filter(q => q.type === 'GAP_FILL').sort((a, b) => a.id - b.id);
                if (gapFillQuestions.length > 0) {
                    const gapSection = document.createElement('div');
                    gapSection.className = 'mb-6';
                    gapSection.innerHTML = `
                        <h3 class="font-bold mb-4">Questions ${gapFillQuestions[0].id}‚Äì${gapFillQuestions[gapFillQuestions.length - 1].id}</h3>
                        <p class="text-sm text-gray-700 mb-2">Complete the notes below.</p>
                        <p class="text-sm text-gray-700 mb-4">Write <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                        
                        <div class="bg-gray-50 p-6 mb-4">
                            <div class="text-center mb-6">
                                <h4 class="font-bold text-base">The Development of the Guitar</h4>
                            </div>
                            
                            <div class="mb-6">
                                <p class="font-bold text-sm mb-3">13th‚Äì19th century: Chitarra</p>
                                <ul class="space-y-3 text-sm">
                                    <li>‚Ä¢ was a development of an earlier instrument called the <span class="inline-input" data-question="7"></span></li>
                                    <li>‚Ä¢ extra strings added in 16th century in Italy</li>
                                </ul>
                            </div>
                            
                            <div class="mb-6">
                                <p class="font-bold text-sm mb-3">From around the 1850s: Classical guitar</p>
                                <ul class="space-y-3 text-sm">
                                    <li>‚Ä¢ its shape a result of modifications including a larger <span class="inline-input" data-question="8"></span> introduced by Antonio Torres</li>
                                    <li>‚Ä¢ changes produced better tone and greater <span class="inline-input" data-question="9"></span></li>
                                </ul>
                            </div>

                            <div class="mb-6">
                                <p class="font-bold text-sm mb-3">X-braced top guitar</p>
                                <ul class="space-y-3 text-sm">
                                    <li>‚Ä¢ first made in <span class="inline-input" data-question="10"></span> in mid-19th century</li>
                                    <li>‚Ä¢ strings made of <span class="inline-input" data-question="11"></span> became available around 1900</li>
                                </ul>
                            </div>

                            <div>
                                <p class="font-bold text-sm mb-3">1920s onwards: Electric guitar</p>
                                <ul class="space-y-3 text-sm">
                                    <li>‚Ä¢ in the 1920s, <span class="inline-input" data-question="12"></span> added to guitars</li>
                                    <li>‚Ä¢ a well-known version brought out by <span class="inline-input" data-question="13"></span></li>
                                </ul>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(gapSection);

                    // Add event listeners for gap fill inputs
                    const inputs = gapSection.querySelectorAll('.inline-input');
                    inputs.forEach(span => {
                        const input = document.createElement('input');
                        const questionId = parseInt(span.getAttribute('data-question'));
                        input.type = 'text';
                        input.className = 'inline-block min-w-32 h-7 border-2 border-gray-400 text-center text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-2';
                        input.placeholder = questionId.toString();
                        input.value = answers[questionId] || '';
                        input.addEventListener('input', (e) => {
                            answers[questionId] = e.target.value;
                            updateQuestionIndicators();
                        });
                        span.appendChild(input);
                    });
                }

                return; // Exit early for Part 1
            }
                

            // Group questions by type
            const flowChartQuestions = part.questions.filter(q => q.type === "FLOW_CHART");
            const trueFalseQuestions = part.questions.filter(q => q.type === "TRUE_FALSE_NOT_GIVEN");
            const multipleChoiceQuestions = part.questions.filter(q => q.type === "MULTIPLE_CHOICE");
            const multipleChoiceMultiQuestions = part.questions.filter(q => q.type === "MULTIPLE_CHOICE_MULTI");
            const virtualMultiQuestions = part.questions.filter(q => q.type === "VIRTUAL_MULTI");
            const summaryQuestions = part.questions.filter(q => q.type === "SUMMARY_COMPLETION");
            const gapFillQuestions = part.questions.filter(q => q.type === "GAP_FILL");
            const paragraphMatchingQuestions = part.questions.filter(q => q.type === "PARAGRAPH_MATCHING");
            const matchingQuestions = part.questions.filter(q => q.type === "MATCHING");
            const dropdownQuestions = part.questions.filter(q => q.type === "DROPDOWN");
            const headingMatchingQuestions = part.questions.filter(q => q.type === "HEADING_MATCHING");
            const placeMatchingQuestions = part.questions.filter(q => q.type === "PLACE_MATCHING");

            // Flow Chart Questions
            if (flowChartQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions ${flowChartQuestions[0].id}‚Äì${flowChartQuestions[flowChartQuestions.length - 1].id}</h3>
                    <p class="text-sm text-gray-700 mb-4">Complete the flow-chart below. Choose <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
                    <p class="text-sm text-gray-700 mb-4">Write your answers in boxes 1-5 on your answer sheet.</p>

                    <div class="bg-gray-50 p-6 mb-4">
                        <div class="text-left space-y-3">
                            <div class="bg-white p-3 text-center">
                                <strong>Clarence Birdseye and the Frozen Food Industry</strong>
                            </div>
                            <div class="text-xl text-center">‚Üì</div>
                            <div class="bg-white p-3">
                                <strong>Early adventures</strong>
                                <ul class="flow-chart-list mt-3 text-sm">
                                    <li>Birdseye grew up hunting and selling animals</li>
                                    <li>he left <span class="inline-input" data-question="1"></span> for financial reasons</li>
                                    <li>his work in Montana was a factor in finding the cause of a widespread <span class="inline-input" data-question="2"></span></li>
                                    <li>he moved to Labrador, where he bought furs for a New York company</li>
                                    <li>he enjoyed the <span class="inline-input" data-question="3"></span> of living in such a harsh environment</li>
                                </ul>
                            </div>
                            <div class="text-xl text-center">‚Üì</div>
                            <div class="bg-white p-3">
                                <strong>A better way to freeze food</strong>
                                <ul class="flow-chart-list mt-3 text-sm">
                                    <li>Birdseye realised that the process of freezing and thawing food changed its taste and texture</li>
                                    <li>while fishing with the Inuit, he made a <span class="inline-input" data-question="4"></span> that could improve frozen food</li>
                                    <li>in the early 20th century, the quality of frozen food was so poor that even some <span class="inline-input" data-question="5"></span> couldn't serve it</li>
                                    <li>Birdseye found that when food was flash-frozen, the <span class="inline-input" data-question="6"></span> of the cells were kept intact</li>
                                    <li>taking out bones from whole fish minimised the air content of the packaging</li>
                                    <li>Birdseye also created a new kind of <span class="inline-input" data-question="7"></span> and glue for packaging</li>
                                    <li>because supermarkets and kitchens lacked freezers, frozen food was not part of the typical American diet before the late 1940s.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(section);

                // Add input fields for flow chart
                section.querySelectorAll('.inline-input').forEach(span => {
                    const questionId = parseInt(span.dataset.question);

                    // Add ID to the span for navigation
                    span.id = `question-${questionId}`;

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'inline-block min-w-32 h-7 border-2 border-gray-400 text-center text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-2';
                    input.placeholder = questionId.toString();
                    input.value = answers[questionId] || '';
                    input.addEventListener('input', (e) => {
                        answers[questionId] = e.target.value;
                        updateQuestionIndicators();
                    });
                    span.appendChild(input);
                });
            }

            // Gap Fill Questions (1-5) - Carnivorous Plants Notes
            if (gapFillQuestions.filter(q => q.id >= 1 && q.id <= 5).length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 1-5</h3>
                    <p class="text-sm text-gray-700 mb-4">Complete the notes below.</p>
                    <p class="text-sm text-gray-700 mb-4">Write <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                    
                    <div class="bg-gray-50 p-6 mb-4">
                        <div class="text-center mb-4">
                            <h4 class="font-bold text-base">Carnivorous Plants</h4>
                        </div>
                        
                        <div class="mb-4">
                            <p class="font-semibold text-sm mb-2 underline">Darwin's experiments:</p>
                            
                            <div class="ml-4 mb-3">
                                <p class="font-medium text-sm mb-1">Drosera</p>
                                <ul class="list-disc ml-6 text-sm space-y-1">
                                    <li>He put insects and small amounts of meat onto leaves and observed what happened.</li>
                                    <li>He was amazed that one human hair triggered a response.</li>
                                    <li>He understood why the plant did not respond to <span class="inline-input" data-question="1"></span></li>
                                </ul>
                            </div>
                            
                            <div class="ml-4 mb-3">
                                <p class="font-medium text-sm mb-1">Venus Flytrap</p>
                                <ul class="list-disc ml-6 text-sm space-y-1">
                                    <li>He demonstrated how leaves close and then, for a short period, act like a <span class="inline-input" data-question="2"></span></li>
                                    <li>He noted the structure of leaves ensures small insects are released.</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <p class="font-semibold text-sm mb-2 underline">Biology today:</p>
                            
                            <div class="ml-4 mb-3">
                                <p class="font-medium text-sm mb-1">Venus Flytrap</p>
                                <ul class="list-disc ml-6 text-sm space-y-1">
                                    <li>The charge enters fluid-filled tunnels, causing <span class="inline-input" data-question="3"></span> in the cell walls to open.</li>
                                    <li>Water moves between cells and then the leaf changes from convex to concave, trapping the insect inside.</li>
                                </ul>
                            </div>
                            
                            <div class="ml-4 mb-3">
                                <p class="font-medium text-sm mb-1">Bladderwort</p>
                                <ul class="list-disc ml-6 text-sm space-y-1">
                                    <li>When water is pumped out of bladder cells, a <span class="inline-input" data-question="4"></span> builds up inside.</li>
                                </ul>
                            </div>
                            
                            <div class="ml-4">
                                <p class="font-medium text-sm mb-1">Pitcher Plants</p>
                                <ul class="list-disc ml-6 text-sm space-y-1">
                                    <li>The plants have tube-shaped leaves that insects fall into.</li>
                                    <li>Some plants are big enough to capture and eat <span class="inline-input" data-question="5"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(section);

                // Add event listeners for gap fill inputs
                const inputs = section.querySelectorAll('.inline-input');
                inputs.forEach(span => {
                    const input = document.createElement('input');
                    const questionId = parseInt(span.getAttribute('data-question'));
                    input.type = 'text';
                    input.className = 'inline-block min-w-32 h-7 border-2 border-gray-400 text-center text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-2';
                    input.placeholder = questionId.toString();
                    input.value = answers[questionId] || '';
                    input.addEventListener('input', (e) => {
                        answers[questionId] = e.target.value;
                        updateQuestionIndicators();
                    });
                    span.appendChild(input);
                });
            }


            // Special handling for Part 2 - Playing Soccer
            if (part.id === 2) {
                // Questions 14-19: Paragraph Selection (which paragraph contains the information)
                const paragraphSelectionQuestions = part.questions.filter(q => q.type === "PARAGRAPH_SELECTION" && q.id >= 14 && q.id <= 19);
                if (paragraphSelectionQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions 14‚Äì19</h3>
                        <p class="text-sm text-gray-700 mb-2">Reading Passage 2 has seven sections, A‚ÄìG.</p>
                        <p class="text-sm text-gray-700 mb-2">Which section contains the following information?</p>
                        <p class="text-sm text-gray-700 mb-4">Write the correct letter, <strong>A‚ÄìG</strong>, in boxes 14‚Äì19 on your answer sheet.</p>
                    `;
                    
                    let questionsHtml = `<div class="space-y-1">`;
                    paragraphSelectionQuestions.forEach(question => {
                        questionsHtml += `
                            <div class="question-item flex items-center gap-1 py-1" id="question-${question.id}">
                                <span class="font-bold text-black min-w-fit text-sm">${question.id}</span>
                                <p class="text-sm text-gray-700">${question.text}</p>
                                <select id="dropdown-${question.id}" class="border-2 border-gray-400 rounded px-2 py-1 text-sm text-black ml-4">
                                </select>
                            </div>
                        `;
                    });
                    questionsHtml += `</div>`;
                    section.innerHTML += questionsHtml;
                    container.appendChild(section);
                    
                    // Add dropdown options for each paragraph selection question
                    paragraphSelectionQuestions.forEach(question => {
                        const select = container.querySelector(`#dropdown-${question.id}`);
                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = '';
                        select.appendChild(emptyOption);
                        
                        ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(letter => {
                            const optionEl = document.createElement('option');
                            optionEl.value = letter;
                            optionEl.textContent = letter;
                            if (answers[question.id] === letter) {
                                optionEl.selected = true;
                            }
                            select.appendChild(optionEl);
                        });
                        
                        select.addEventListener('change', (e) => {
                            answers[question.id] = e.target.value;
                            updateQuestionIndicators();
                        });
                    });
                }

                // Questions 20-21: Multiple choice (choose two)
                const multiChoiceReasons = part.questions.find(q => q.type === "MULTIPLE_CHOICE_MULTI" && q.id === 20);
                if (multiChoiceReasons) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-2">Questions 20‚Äì21</h3>
                        <p class="text-sm text-gray-700 mb-2">Choose <strong>TWO</strong> correct answers.</p>
                        <p class="text-sm text-gray-700 mb-4">Write the correct letters in boxes 20‚Äì21 on your answer sheet.</p>
                        <p class="text-sm text-gray-700 mb-4">${multiChoiceReasons.text}</p>
                    `;

                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'space-y-2';
                    optionsDiv.id = `question-${multiChoiceReasons.id}`;

                    multiChoiceReasons.options.forEach(option => {
                        const label = document.createElement('label');
                        label.className = 'flex items-center space-x-2 cursor-pointer text-sm text-gray-700';
                        const currentAnswers = answers[multiChoiceReasons.id] || [];
                        const isChecked = Array.isArray(currentAnswers) && currentAnswers.includes(option.value);
                        const optionFirstChar = option.label.charAt(0);
                        const optionRest = option.label.substring(1);
                        label.innerHTML = `
                            <input type="checkbox" value="${option.value}" ${isChecked ? 'checked' : ''} class="w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500">
                            <span><strong>${optionFirstChar}</strong>${optionRest}</span>
                        `;
                        label.querySelector('input').addEventListener('change', (e) => {
                            const selected = answers[multiChoiceReasons.id] || [];
                            if (e.target.checked) {
                                if (selected.length >= 2) {
                                    e.target.checked = false;
                                    return;
                                }
                                if (!selected.includes(option.value)) selected.push(option.value);
                            } else {
                                const idx = selected.indexOf(option.value);
                                if (idx !== -1) selected.splice(idx, 1);
                            }
                            answers[multiChoiceReasons.id] = selected;
                            updateQuestionIndicators();
                        });
                        optionsDiv.appendChild(label);
                    });

                    section.appendChild(optionsDiv);
                    container.appendChild(section);
                }

                // Questions 22-23: Multiple choice (choose two)
                const multiChoiceResults = part.questions.find(q => q.type === "MULTIPLE_CHOICE_MULTI" && q.id === 22);
                if (multiChoiceResults) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-2">Questions 22‚Äì23</h3>
                        <p class="text-sm text-gray-700 mb-2">Choose <strong>TWO</strong> correct answers.</p>
                        <p class="text-sm text-gray-700 mb-4">Write the correct letters in boxes 22‚Äì23 on your answer sheet.</p>
                        <p class="text-sm text-gray-700 mb-4">${multiChoiceResults.text}</p>
                    `;

                    const optionsDiv = document.createElement('div');
                    optionsDiv.className = 'space-y-2';
                    optionsDiv.id = `question-${multiChoiceResults.id}`;

                    multiChoiceResults.options.forEach(option => {
                        const label = document.createElement('label');
                        label.className = 'flex items-center space-x-2 cursor-pointer text-sm text-gray-700';
                        const currentAnswers = answers[multiChoiceResults.id] || [];
                        const isChecked = Array.isArray(currentAnswers) && currentAnswers.includes(option.value);
                        const optionFirstChar = option.label.charAt(0);
                        const optionRest = option.label.substring(1);
                        label.innerHTML = `
                            <input type="checkbox" value="${option.value}" ${isChecked ? 'checked' : ''} class="w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500">
                            <span><strong>${optionFirstChar}</strong>${optionRest}</span>
                        `;
                        label.querySelector('input').addEventListener('change', (e) => {
                            const selected = answers[multiChoiceResults.id] || [];
                            if (e.target.checked) {
                                if (selected.length >= 2) {
                                    e.target.checked = false;
                                    return;
                                }
                                if (!selected.includes(option.value)) selected.push(option.value);
                            } else {
                                const idx = selected.indexOf(option.value);
                                if (idx !== -1) selected.splice(idx, 1);
                            }
                            answers[multiChoiceResults.id] = selected;
                            updateQuestionIndicators();
                        });
                        optionsDiv.appendChild(label);
                    });

                    section.appendChild(optionsDiv);
                    container.appendChild(section);
                }

                // Questions 24-26: Summary completion
                const gapFillQuestions = part.questions.filter(q => q.type === 'GAP_FILL' && q.id >= 24 && q.id <= 26);
                if (gapFillQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions 24‚Äì26</h3>
                        <p class="text-sm text-gray-700 mb-2">Complete the summary below.</p>
                        <p class="text-sm text-gray-700 mb-4">Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>

                        <div class="bg-gray-50 p-6 mb-4">
                            <div class="text-center mb-4">
                                <h4 class="font-bold text-base">Winners and losers</h4>
                            </div>
                            <div class="space-y-3 text-sm text-gray-700">
                                <p>For youth soccer players, a key <strong>24</strong> <span class="inline-input" data-question="24"></span> is that they should always come away from the game with a positive attitude. In this respect, regardless of the effort the players make, they get some kind of <strong>25</strong> <span class="inline-input" data-question="25"></span> at the end of a game.</p>
                                <p>In street soccer, however, players gain resilience because they have to learn to cope with failure. But the outcome of a match isn‚Äôt remembered for long. In fact, no-one ever keeps a <strong>26</strong> <span class="inline-input" data-question="26"></span> of the results of games.</p>
                            </div>
                        </div>
                    `;

                    container.appendChild(section);

                    const inputs = section.querySelectorAll('.inline-input');
                    inputs.forEach(span => {
                        const input = document.createElement('input');
                        const questionId = parseInt(span.getAttribute('data-question'));
                        input.type = 'text';
                        input.className = 'inline-block min-w-32 h-7 border-2 border-gray-400 text-center text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-2';
                        input.placeholder = '';
                        input.value = answers[questionId] || '';
                        input.addEventListener('input', (e) => {
                            answers[questionId] = e.target.value;
                            updateQuestionIndicators();
                        });
                        span.appendChild(input);
                    });
                }

                return; // Exit early for Part 2
            }

            // Special handling for Part 2 - render in specific order: Multiple Choice, True/False, Dropdown
            if (part.id === 2 && false) {
                // Multiple Choice Questions (14-16) - FIRST
                if (multipleChoiceQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions ${multipleChoiceQuestions[0].id}‚Äì${multipleChoiceQuestions[multipleChoiceQuestions.length - 1].id}</h3>
                        <p class="text-sm text-gray-700 mb-4">Choose the correct letter, <strong>A</strong>, <strong>B</strong>, <strong>C</strong> or <strong>D</strong>.</p>
                        <div class="space-y-6" id="multiple-choice-questions"></div>
                    `;
                    container.appendChild(section);

                    const questionsDiv = section.querySelector('#multiple-choice-questions');
                    multipleChoiceQuestions.forEach(question => {
                        const questionDiv = createMultipleChoiceQuestion(question);
                        questionsDiv.appendChild(questionDiv);
                    });
                }

                // True/False Questions (17-21) - SECOND
                if (trueFalseQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions ${trueFalseQuestions[0].id}‚Äì${trueFalseQuestions[trueFalseQuestions.length - 1].id}</h3>
                        <p class="text-sm text-gray-700 mb-4">Do the following statements agree with the claims of the writer in Reading Passage?</p>
                        <p class="text-sm text-gray-700 mb-4">
                            On your answer sheet please write<br/>
                            <strong>TRUE</strong> if the statement agrees with the writer<br/>
                            <strong>FALSE</strong> if the statement contradicts with the writer<br/>
                            <strong>NOT GIVEN</strong> if there is no information about this in the passage.
                        </p>
                        <div class="space-y-4" id="true-false-questions"></div>
                    `;
                    container.appendChild(section);

                    const questionsDiv = section.querySelector('#true-false-questions');
                    trueFalseQuestions.forEach(question => {
                        const questionDiv = createTrueFalseQuestion(question);
                        questionsDiv.appendChild(questionDiv);
                    });
                }

                // Dropdown Questions (22-26) - THIRD
                if (dropdownQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions ${dropdownQuestions[0].id}‚Äì${dropdownQuestions[dropdownQuestions.length - 1].id}</h3>
                        <p class="text-sm text-gray-700 mb-4">Complete each sentence with the correct ending, <strong>A-F</strong>, below.</p>
                        
                        <div class="bg-gray-100 p-4 mb-4">
                            <h4 class="font-bold mb-3">Choose from the following options:</h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>A</strong> are not applicable to all societies.</div>
                                <div><strong>B</strong> provides a hopeful perspective.</div>
                                <div><strong>C</strong> is embodied in physical structures.</div>
                                <div><strong>D</strong> is potentially both positive and negative.</div>
                                <div><strong>E</strong> will not address current issues directly.</div>
                                <div><strong>F</strong> have increased compared to the past.</div>
                            </div>
                        </div>
                        
                        <div class="space-y-4" id="dropdown-questions"></div>
                    `;
                    container.appendChild(section);

                    const questionsDiv = section.querySelector('#dropdown-questions');
                    dropdownQuestions.forEach(question => {
                        const questionDiv = createDropdownQuestion(question);
                        questionsDiv.appendChild(questionDiv);
                    });
                }
                return; // Exit early for Part 2
            }

            // Special handling for Part 3 - Memory Champions
            if (part.id === 3) {
                // Questions 27-32: Paragraph Selection
                const paragraphSelectionQuestions = part.questions.filter(q => q.type === "PARAGRAPH_SELECTION" && q.id >= 27 && q.id <= 32);
                if (paragraphSelectionQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions 27‚Äì32</h3>
                        <p class="text-sm text-gray-700 mb-2">Reading Passage 3 has seven paragraphs, A‚ÄìG.</p>
                        <p class="text-sm text-gray-700 mb-2">Which paragraph contains the following information?</p>
                        <p class="text-sm text-gray-700 mb-4">Choose the correct letter, <strong>A‚ÄìG</strong>, in boxes 27‚Äì32 on your answer sheet.</p>
                    `;

                    let questionsHtml = `<div class="space-y-1">`;
                    paragraphSelectionQuestions.forEach(question => {
                        questionsHtml += `
                            <div class="question-item flex items-center gap-1 py-1" id="question-${question.id}">
                                <span class="font-bold text-black min-w-fit text-sm">${question.id}</span>
                                <p class="text-sm text-gray-700">${question.text}</p>
                                <select id="dropdown-${question.id}" class="border-2 border-gray-400 rounded px-2 py-1 text-sm text-black ml-4"></select>
                            </div>
                        `;
                    });
                    questionsHtml += `</div>`;
                    section.innerHTML += questionsHtml;
                    container.appendChild(section);

                    paragraphSelectionQuestions.forEach(question => {
                        const select = container.querySelector(`#dropdown-${question.id}`);
                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = '';
                        select.appendChild(emptyOption);

                        ['A', 'B', 'C', 'D', 'E', 'F', 'G'].forEach(letter => {
                            const optionEl = document.createElement('option');
                            optionEl.value = letter;
                            optionEl.textContent = letter;
                            if (answers[question.id] === letter) {
                                optionEl.selected = true;
                            }
                            select.appendChild(optionEl);
                        });

                        select.addEventListener('change', (e) => {
                            answers[question.id] = e.target.value;
                            updateQuestionIndicators();
                        });
                    });
                }

                // Questions 33-36: Summary completion
                const gapFillQuestions = part.questions.filter(q => q.type === 'GAP_FILL' && q.id >= 33 && q.id <= 36);
                if (gapFillQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions 33‚Äì36</h3>
                        <p class="text-sm text-gray-700 mb-2">Complete the summary below.</p>
                        <p class="text-sm text-gray-700 mb-2">Choose <strong>NO MORE THAN THREE WORDS</strong> from the passage for each answer.</p>
                        <p class="text-sm text-gray-700 mb-4">Write your answers in boxes 33‚Äì36 on your answer sheet.</p>

                        <div class="bg-gray-50 p-6 mb-4">
                            <div class="text-center mb-4">
                                <h4 class="font-bold text-base">Using visual imagery and spatial navigation to remember numbers</h4>
                            </div>
                            <div class="space-y-3 text-sm text-gray-700">
                                <p>A <strong>33</strong> <span class="inline-input" data-question="33"></span>, an action, and a thing are assigned to consecutive cards in the pack. Combining these images allows Cooke to memorise <strong>34</strong> <span class="inline-input" data-question="34"></span> at a time.</p>
                                <p>The mind pictures are then positioned on a <strong>35</strong> <span class="inline-input" data-question="35"></span>. The pack of cards is remembered by going for a <strong>36</strong> <span class="inline-input" data-question="36"></span> while the pictures are converted back into cards.</p>
                            </div>
                        </div>
                    `;

                    container.appendChild(section);

                    const inputs = section.querySelectorAll('.inline-input');
                    inputs.forEach(span => {
                        const input = document.createElement('input');
                        const questionId = parseInt(span.getAttribute('data-question'));
                        input.type = 'text';
                        input.className = 'inline-block min-w-32 h-7 border-2 border-gray-400 text-center text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-2';
                        input.placeholder = '';
                        input.value = answers[questionId] || '';
                        input.addEventListener('input', (e) => {
                            answers[questionId] = e.target.value;
                            updateQuestionIndicators();
                        });
                        span.appendChild(input);
                    });
                }

                // Questions 37-40: Matching sentence endings
                const matchingQuestions = part.questions.filter(q => q.type === 'MATCHING' && q.id >= 37 && q.id <= 40);
                if (matchingQuestions.length > 0) {
                    const section = document.createElement('div');
                    section.className = 'mb-6';
                    section.innerHTML = `
                        <h3 class="font-bold mb-4">Questions 37‚Äì40</h3>
                        <p class="text-sm text-gray-700 mb-2">Complete each sentence with the correct ending, <strong>A‚ÄìF</strong>, below.</p>
                        <p class="text-sm text-gray-700 mb-4">Write the correct letter, <strong>A‚ÄìF</strong>, in boxes 37‚Äì40 on your answer sheet.</p>
                    `;

                    const optionsBox = document.createElement('div');
                    optionsBox.className = 'border-2 border-gray-400 p-3 mb-6 bg-gray-50 rounded inline-block';
                    optionsBox.innerHTML = `
                        <p class="font-bold mb-2 text-sm text-black">Endings</p>
                        <div class="text-sm text-gray-700 space-y-1">
                            <div><strong>A.</strong> used mainly for educational purposes.</div>
                            <div><strong>B.</strong> activated brain areas associated with visual and spatial memory.</div>
                            <div><strong>C.</strong> became widespread in ancient Greece for memorizing speeches and texts.</div>
                            <div><strong>D.</strong> the result of techniques and extensive practice.</div>
                            <div><strong>E.</strong> retaining a wide variety of tasks.</div>
                            <div><strong>F.</strong> benefited from additional cognitive abilities.</div>
                        </div>
                    `;
                    section.appendChild(optionsBox);

                    const questionsDiv = document.createElement('div');
                    questionsDiv.className = 'space-y-1 mt-4';

                    matchingQuestions.forEach(question => {
                        const questionDiv = document.createElement('div');
                        questionDiv.className = 'question-item flex items-center gap-1 py-1';
                        questionDiv.id = `question-${question.id}`;

                        const numberSpan = document.createElement('span');
                        numberSpan.className = 'font-bold text-black min-w-fit text-sm';
                        numberSpan.textContent = question.id;

                        const textP = document.createElement('p');
                        textP.className = 'text-sm text-gray-700';
                        textP.textContent = question.text;

                        const select = document.createElement('select');
                        select.id = `dropdown-${question.id}`;
                        select.className = 'border-2 border-gray-400 rounded px-2 py-1 text-sm text-black font-medium min-w-[64px] ml-2';

                        const emptyOption = document.createElement('option');
                        emptyOption.value = '';
                        emptyOption.textContent = '';
                        select.appendChild(emptyOption);

                        question.options.forEach(option => {
                            const optionEl = document.createElement('option');
                            optionEl.value = option.value;
                            optionEl.textContent = option.value;
                            if (answers[question.id] === option.value) {
                                optionEl.selected = true;
                            }
                            select.appendChild(optionEl);
                        });

                        select.addEventListener('change', (e) => {
                            answers[question.id] = e.target.value;
                            updateQuestionIndicators();
                        });

                        questionDiv.appendChild(numberSpan);
                        questionDiv.appendChild(textP);
                        questionDiv.appendChild(select);
                        questionsDiv.appendChild(questionDiv);
                    });

                    section.appendChild(questionsDiv);
                    container.appendChild(section);
                }

                return; // Exit early for Part 3
            }

            // Default rendering for other parts
            // True/False Questions
            if (trueFalseQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions ${trueFalseQuestions[0].id}‚Äì${trueFalseQuestions[trueFalseQuestions.length - 1].id}</h3>
                    <p class="text-sm text-gray-700 mb-4">Do the following statements agree with the claims of the writer in Reading Passage?</p>
                    <p class="text-sm text-gray-700 mb-4">
                        On your answer sheet please write<br/>
                        <strong>TRUE</strong> if the statement agrees with the writer<br/>
                        <strong>FALSE</strong> if the statement contradicts with the writer<br/>
                        <strong>NOT GIVEN</strong> if there is no information about this in the passage.
                    </p>
                    <div class="space-y-4" id="true-false-questions"></div>
                `;
                container.appendChild(section);

                const questionsDiv = section.querySelector('#true-false-questions');
                trueFalseQuestions.forEach(question => {
                    const questionDiv = createTrueFalseQuestion(question);
                    questionsDiv.appendChild(questionDiv);
                });
            }

            // Multiple Choice Questions (exclude question 40 for Part 3 as it has its own section)
            const filteredMultipleChoice = part.id === 3 ? multipleChoiceQuestions.filter(q => q.id !== 40) : multipleChoiceQuestions;
            if (filteredMultipleChoice.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions ${filteredMultipleChoice[0].id}‚Äì${filteredMultipleChoice[filteredMultipleChoice.length - 1].id}</h3>
                    <p class="text-sm text-gray-700 mb-4">Choose the correct letter, <strong>A</strong>, <strong>B</strong>, <strong>C</strong> or <strong>D</strong>.</p>
                    <div class="space-y-6" id="multiple-choice-questions"></div>
                `;
                container.appendChild(section);

                const questionsDiv = section.querySelector('#multiple-choice-questions');
                filteredMultipleChoice.forEach(question => {
                    const questionDiv = createMultipleChoiceQuestion(question);
                    questionsDiv.appendChild(questionDiv);
                });
            }

            // Summary Drag-and-Drop Questions (32-36) for Part 3
            const summaryDragDropQuestions = part.questions.filter(q => q.type === 'SUMMARY_DRAG_DROP');
            if (summaryDragDropQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 32-36</h3>
                    <p class="text-sm text-gray-700 mb-4">Complete the summary using the list of words, <strong>A-I</strong>, below.</p>
                    
                    <div class="bg-gray-50 p-6 mb-4">
                        <div class="text-center mb-4">
                            <h4 class="font-bold text-base">Piaget's Theories on Children's Cognitive Development</h4>
                        </div>
                        
                        <div class="text-sm leading-relaxed">
                            <p class="mb-4">
                                Piaget maintained that children's mental processes were far more <span class="inline-drop-zone border border-dashed border-gray-400 bg-gray-50 text-gray-600 px-2 py-1 min-w-16 rounded inline-block text-center text-sm" data-question="32">32</span> than they might 
                                appear. He encouraged the view that a child was not a blank state waiting to be filled with 
                                information, but rather a systematic builder of knowledge who regularly tries to hit or her own 
                                <span class="inline-drop-zone border border-dashed border-gray-400 bg-gray-50 text-gray-600 px-2 py-1 min-w-16 rounded inline-block text-center text-sm" data-question="33">33</span> about the world. Piaget's impact on the area of <span class="inline-drop-zone border border-dashed border-gray-400 bg-gray-50 text-gray-600 px-2 py-1 min-w-16 rounded inline-block text-center text-sm" data-question="34">34</span> could well outlast 
                                that of more celebrated pioneers of this discipline. Despite doubts cast on his ideas by the current 
                                fashion associating knowledge exclusively with the <span class="inline-drop-zone border border-dashed border-gray-400 bg-gray-50 text-gray-600 px-2 py-1 min-w-16 rounded inline-block text-center text-sm" data-question="35">35</span>, the effects of his work are still 
                                strong today. His principles are still widely used in the professional development of <span class="inline-drop-zone border border-dashed border-gray-400 bg-gray-50 text-gray-600 px-2 py-1 min-w-16 rounded inline-block text-center text-sm" data-question="36">36</span>.
                            </p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 mb-6 border-2 border-dashed border-gray-300">
                        <div class="grid grid-cols-3 gap-2">
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="A"><span class="font-bold mr-2">A</span>correct</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="B"><span class="font-bold mr-2">B</span>theories</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="C"><span class="font-bold mr-2">C</span>brain</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="D"><span class="font-bold mr-2">D</span>simple</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="E"><span class="font-bold mr-2">E</span>teachers</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="F"><span class="font-bold mr-2">F</span>psychology</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="G"><span class="font-bold mr-2">G</span>logical</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="H"><span class="font-bold mr-2">H</span>thought</div>
                            <div class="draggable-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="I"><span class="font-bold mr-2">I</span>philosophers</div>
                        </div>
                    </div>
                `;
                container.appendChild(section);

                // Initialize drag and drop functionality for summary
                initializeSummaryDragDrop();
            }

            // YES/NO/NOT GIVEN Questions (37-40) for Part 3
            const yesNoNotGivenQuestions = part.questions.filter(q => q.type === 'YES_NO_NOT_GIVEN');
            if (yesNoNotGivenQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 37-40</h3>
                    <p class="text-sm text-gray-700 mb-2">Do the following statements agree with writer's view in Reading Passage 3?</p>
                    <p class="text-sm text-gray-700 mb-4">Write</p>
                    <div class="ml-4 text-sm text-gray-700 mb-6">
                        <p><strong>YES</strong> if the statement agrees with the writer's opinion</p>
                        <p><strong>NO</strong> if the statement contradicts the writer's opinion</p>
                        <p><strong>NOT GIVEN</strong> if there is no information on this</p>
                    </div>
                `;
                
                const questionsDiv = document.createElement('div');
                questionsDiv.className = 'space-y-4';
                
                yesNoNotGivenQuestions.forEach(question => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'flex items-start space-x-3';
                    questionDiv.innerHTML = `
                        <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                            ${question.id}
                        </div>
                        <div class="flex-1">
                            <p class="text-sm mb-2">${question.text}</p>
                            <div class="flex space-x-4">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="question-${question.id}" value="YES" 
                                           ${answers[question.id] === 'YES' ? 'checked' : ''} 
                                           class="w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500">
                                    <span class="text-sm">YES</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="question-${question.id}" value="NO" 
                                           ${answers[question.id] === 'NO' ? 'checked' : ''} 
                                           class="w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500">
                                    <span class="text-sm">NO</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="question-${question.id}" value="NOT GIVEN" 
                                           ${answers[question.id] === 'NOT GIVEN' ? 'checked' : ''} 
                                           class="w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500">
                                    <span class="text-sm">NOT GIVEN</span>
                                </label>
                            </div>
                        </div>
                    `;

                    // Add event listeners for radio buttons
                    questionDiv.querySelectorAll('input[type="radio"]').forEach(radio => {
                        radio.addEventListener('change', () => {
                            answers[question.id] = radio.value;
                            updateQuestionIndicators();
                        });
                    });
                    
                    questionsDiv.appendChild(questionDiv);
                });
                
                section.appendChild(questionsDiv);
                container.appendChild(section);
            }

            // Summary Completion Questions (11-13)
            if (summaryQuestions.filter(q => q.id >= 11 && q.id <= 13).length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 11-13</h3>
                    <p class="text-sm text-gray-700 mb-4">Complete the following summary of the paragraphs of Reading Passage 1, using <strong>NO MORE THAN TWO WORDS</strong> from the Reading Passage for each answer.</p>
                    <p class="text-sm text-gray-700 mb-4">Write your answers in boxes 11-13 on your answer sheet.</p>

                    <div class="bg-gray-50 p-4 mb-4">
                        <p class="text-sm leading-relaxed">
                            While experts outperform novices and machines in pattern recognition and problem solving, expert predictions of future behavior or events are seldom as accurate as simple actuarial tables. Why? Some have tried to explain that experts differ when using cognitive <span class="inline-input" data-question="11"></span> to forecast. Researchers believe it is due to <span class="inline-input" data-question="12"></span>. However attempting endeavour of finding answers did not yet produce <span class="inline-input" data-question="13"></span>.
                        </p>
                    </div>
                `;
                container.appendChild(section);

                // Add input fields
                section.querySelectorAll('.inline-input').forEach(span => {
                    const questionId = parseInt(span.dataset.question);

                    // Add ID to the span for navigation
                    span.id = `question-${questionId}`;

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'inline-block min-w-32 h-7 border-2 border-gray-400 text-center text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-2';
                    input.placeholder = questionId.toString();
                    input.value = answers[questionId] || '';
                    input.addEventListener('input', (e) => {
                        answers[questionId] = e.target.value;
                        updateQuestionIndicators();
                    });
                    span.appendChild(input);
                });
            }


            // Matching Questions
            if (matchingQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions ${matchingQuestions[0].id}‚Äì${matchingQuestions[matchingQuestions.length - 1].id}</h3>
                    <p class="text-sm text-gray-700 mb-4">Matching the <strong>each correct year</strong> to the <strong>historical event</strong> in the passage,</p>
                    <p class="text-sm text-gray-700 mb-4">and write the correct answer into box of 27-31 in the answer sheet</p>
                    <div id="matching-questions"></div>
                `;
                container.appendChild(section);

                const matchingDiv = section.querySelector('#matching-questions');
                createMatchingQuestions(matchingDiv, matchingQuestions);
            }

            // Paragraph Matching Questions (14-17)
            if (paragraphMatchingQuestions.filter(q => q.id >= 14 && q.id <= 17).length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 14-17</h3>
                    <p class="text-sm text-gray-700 mb-4">The passage has paragraphs as A-G; which paragraph contains the following information?</p>
                    <p class="text-sm text-gray-700 mb-4">Write the appropriate letter A-G for box 14-17 on your answer sheet.</p>
                    <p class="text-sm text-gray-700 mb-4"><strong>NB</strong> You may use any letter more than once.</p>
                    <div class="space-y-4" id="summary-14-17"></div>
                `;
                container.appendChild(section);

                const summaryDiv = section.querySelector('#summary-14-17');
                paragraphMatchingQuestions.filter(q => q.id >= 14 && q.id <= 17).forEach(question => {
                    const questionDiv = createParagraphMatchingQuestion(question);
                    summaryDiv.appendChild(questionDiv);
                });
            }

            // Gap Filling Questions (18-24)
            if (gapFillQuestions.filter(q => q.id >= 18 && q.id <= 24).length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 18-24</h3>
                    <p class="text-sm text-gray-700 mb-4">Complete the sentences below.</p>
                    <p class="text-sm text-gray-700 mb-4">Choose <strong>ONE WORD ONLY</strong> from the passage for each answer.</p>
                    <p class="text-sm text-gray-700 mb-4"><em>Write your answers in boxes 18-24 below.</em></p>

                    <div class="bg-gray-50 p-4 mb-4">
                        <p class="text-sm leading-relaxed">
                            It appears that placebos can treat or reduce the <span class="inline-input" data-question="18"></span> of a wide range of conditions. The placebo effect happens when our <span class="inline-input" data-question="19"></span> has an effect on how our body feels.
                        </p>
                        <p class="text-sm leading-relaxed mt-3">
                            Doctors have long believed it to be their responsibility not only to treat patients' medical conditions, but also to improve their <span class="inline-input" data-question="20"></span>. An example of a situation where a placebo has little or no effect is if a patient has an <span class="inline-input" data-question="21"></span>.
                        </p>
                        <p class="text-sm leading-relaxed mt-3">
                            It has been shown that patients will feel <span class="inline-input" data-question="22"></span> in their muscles if they are given a placebo called a muscle stimulator. A related phenomenon, known as the <span class="inline-input" data-question="23"></span> effect, convinces people that a treatment will do them harm.
                        </p>
                        <p class="text-sm leading-relaxed mt-3">
                            Two factors which influence the effectiveness of a placebo pill are its <span class="inline-input" data-question="24"></span> and its size.
                        </p>
                    </div>
                `;
                container.appendChild(section);

                // Add input fields for gap filling
                section.querySelectorAll('.inline-input').forEach(span => {
                    const questionId = parseInt(span.dataset.question);

                    // Add ID to the span for navigation
                    span.id = `question-${questionId}`;

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'inline-block min-w-16 h-6 border-2 border-gray-400 text-center text-xs bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-1';
                    input.placeholder = questionId.toString();
                    input.value = answers[questionId] || '';
                    input.addEventListener('input', (e) => {
                        answers[questionId] = e.target.value;
                        updateQuestionIndicators();
                    });
                    span.appendChild(input);
                });
            }

            // Multiple Choice Multi Questions (25-26)
            if (multipleChoiceMultiQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 25-26</h3>
                    <p class="text-sm text-gray-700 mb-4">Choose <strong>TWO</strong> letters, <strong>A-E</strong>.</p>
                    <p class="text-sm text-gray-700 mb-4">Which <strong>TWO</strong> findings were observed in the Harvard Medical School study?</p>
                    <p class="text-sm text-gray-700 mb-4"><em>Write your answers in boxes 25-26 on your answer sheet.</em></p>
                    <div class="space-y-4" id="multi-choice-25-26"></div>
                `;
                container.appendChild(section);

                const multiDiv = section.querySelector('#multi-choice-25-26');
                // Only render question 25, but it handles both 25 and 26 answers
                const question25 = multipleChoiceMultiQuestions.find(q => q.id === 25);
                if (question25) {
                    const questionDiv = createMultipleChoiceMultiQuestion(question25);
                    multiDiv.appendChild(questionDiv);
                }
            }

            // Heading Matching Questions (27-31)
            if (headingMatchingQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 27-31</h3>
                    <p class="text-sm text-gray-700 mb-4">Reading Passage 3 has five sections.</p>
                    <p class="text-sm text-gray-700 mb-4">Choose the correct heading for each section from the list of headings below.</p>
                    <p class="text-sm text-gray-700 mb-4">Choose the correct number, <strong>i-vi</strong>, in boxes 27-31.</p>
                    
                    <div class="bg-gray-50 p-4 mb-6 border-2 border-dashed border-gray-300">
                        <h4 class="font-bold mb-3 text-center">List of headings.</h4>
                        <div class="space-y-2" id="heading-options">
                            <div class="heading-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="i">
                                <span class="font-bold mr-3">i</span>Evidence of outdoor dwellings
                            </div>
                            <div class="heading-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="ii">
                                <span class="font-bold mr-3">ii</span>Learning to make fire
                            </div>
                            <div class="heading-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="iii">
                                <span class="font-bold mr-3">iii</span>A perfect place to live
                            </div>
                            <div class="heading-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="iv">
                                <span class="font-bold mr-3">iv</span>Examining the cave contents
                            </div>
                            <div class="heading-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="v">
                                <span class="font-bold mr-3">v</span>Contrasting two types of home
                            </div>
                            <div class="heading-option bg-white py-1 px-2 border border-gray-300 rounded cursor-move shadow-sm hover:shadow-md transition-shadow duration-200" draggable="true" data-value="vi">
                                <span class="font-bold mr-3">vi</span>A vital source of power
                            </div>
                        </div>
                    </div>
                    
                `;
                container.appendChild(section);

                // Add drag and drop functionality
                initializeHeadingDragDrop();
            }

            // Place Matching Questions (32-36)
            if (placeMatchingQuestions.length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 32-36</h3>
                    <p class="text-sm text-gray-700 mb-4">Look at the following findings (Questions 32-36) and the list of places below.</p>
                    <p class="text-sm text-gray-700 mb-4">Match each finding with the correct place <strong>A-E</strong>.</p>
                    <p class="text-sm text-gray-700 mb-4"><strong>NB</strong> You may use any letter more than once.</p>
                    
                    <div class="bg-gray-50 p-4 mb-6 border-2 border-gray-300">
                        <h4 class="font-bold mb-3 text-center">List of Places</h4>
                        <div class="space-y-1 text-sm text-left">
                            <div><strong>A</strong> The P√©rigord region</div>
                            <div><strong>B</strong> Moldova</div>
                            <div><strong>C</strong> The Grotte du Lazaret</div>
                            <div><strong>D</strong> The cave of Baume-Bonne</div>
                            <div><strong>E</strong> Krapina</div>
                        </div>
                    </div>
                    
                    <div class="space-y-4" id="place-matching-questions"></div>
                `;
                container.appendChild(section);

                const questionsDiv = section.querySelector('#place-matching-questions');
                placeMatchingQuestions.forEach(question => {
                    const questionDiv = createPlaceMatchingQuestion(question);
                    questionsDiv.appendChild(questionDiv);
                });
            }

            // Gap Fill Summary Questions (37-39)
            if (gapFillQuestions.filter(q => q.id >= 37 && q.id <= 39).length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Questions 37-39</h3>
                    <p class="text-sm text-gray-700 mb-4">Complete the summary below.</p>
                    <p class="text-sm text-gray-700 mb-4">Write <strong>NO MORE THAN TWO WORDS</strong> from the passage for each answer.</p>
                    
                    <div class="bg-gray-50 p-6 mb-4">
                        <div class="text-center mb-4">
                            <h4 class="font-bold text-base">Piaget's approach to understanding children</h4>
                        </div>
                        
                        <div class="text-sm leading-relaxed">
                            <p class="mb-4">
                                Piaget believed that children are not empty vessels to be filled with knowledge but active builders of knowledge who constantly create and test their own 
                                <span class="inline-input" data-question="37"></span> about the world. 
                                In one famous experiment, when asked 'What makes the wind?' five-year-old Julia replied 'The 
                                <span class="inline-input" data-question="38"></span>'. 
                                Piaget recognized that such beliefs demonstrate <span class="inline-input" data-question="39"></span> within the framework of the child's way of knowing.
                            </p>
                        </div>
                    </div>
                `;
                container.appendChild(section);

                // Add input fields for gap filling
                section.querySelectorAll('.inline-input').forEach(span => {
                    const questionId = parseInt(span.dataset.question);
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'w-40 mx-1 px-2 py-0 border-2 border-gray-400 bg-white text-center focus:border-blue-500 focus:outline-none rounded h-7';
                    input.placeholder = questionId.toString();
                    input.value = answers[questionId] || '';
                    
                    input.addEventListener('input', (e) => {
                        answers[questionId] = e.target.value;
                        updateQuestionIndicators();
                    });
                    
                    span.parentNode.insertBefore(input, span);
                    span.parentNode.removeChild(span);
                });
            }

            // Multiple Choice Question (40)
            if (multipleChoiceQuestions.filter(q => q.id === 40).length > 0) {
                const section = document.createElement('div');
                section.className = 'mb-6';
                section.innerHTML = `
                    <h3 class="font-bold mb-4">Question 40</h3>
                    <p class="text-sm text-gray-700 mb-4">Choose the correct answer.</p>
                    <div class="space-y-6" id="question-40"></div>
                `;
                container.appendChild(section);

                const questionsDiv = section.querySelector('#question-40');
                const question40 = multipleChoiceQuestions.find(q => q.id === 40);
                if (question40) {
                    const questionDiv = createMultipleChoiceQuestion(question40);
                    questionsDiv.appendChild(questionDiv);
                }
            }
        }

        function createTrueFalseQuestion(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.id = `question-${question.id}`;
            div.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                        ${question.id}
                    </div>
                    <div class="flex-1">
                        <p class="mb-3 text-sm">${question.text}</p>
                        <div class="flex space-x-6" id="options-${question.id}"></div>
                    </div>
                </div>
            `;

            const optionsDiv = div.querySelector(`#options-${question.id}`);
            question.options.forEach(option => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer';
                label.innerHTML = `
                    <input type="radio" name="q${question.id}" value="${option.value}" class="w-4 h-4 text-red-600" ${answers[question.id] === option.value ? 'checked' : ''}>
                    <span class="text-sm">${option.label}</span>
                `;
                label.querySelector('input').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        answers[question.id] = e.target.value;
                        updateQuestionIndicators();
                    }
                });
                optionsDiv.appendChild(label);
            });

            return div;
        }

        function createDropdownQuestion(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.id = `question-${question.id}`;
            div.innerHTML = `
                <div class="flex items-center justify-between py-2">
                    <div class="flex items-start space-x-3 flex-1">
                        <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                            ${question.id}
                        </div>
                        <div class="flex-1">
                            <p class="text-sm">${question.text}</p>
                        </div>
                    </div>
                    <select class="border border-gray-400 rounded px-2 py-1 text-sm w-14 bg-white ml-4" id="dropdown-${question.id}">
                        <option value="">${question.id}</option>
                        ${question.options.map(option => 
                            `<option value="${option.value}">${option.value}</option>`
                        ).join('')}
                    </select>
                </div>
            `;

            const select = div.querySelector(`#dropdown-${question.id}`);
            select.addEventListener('change', function() {
                answers[question.id] = this.value;
                updateQuestionIndicators();
            });

            // Set saved answer if exists
            if (answers[question.id]) {
                select.value = answers[question.id];
            }

            return div;
        }

        function createMultipleChoiceMultiQuestion(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.id = `question-${question.id}`;
            div.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="flex space-x-1 flex-shrink-0">
                        <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                            25
                        </div>
                        <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                            26
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="mb-3 text-sm">${question.text}</p>
                        <div class="space-y-2" id="options-${question.id}"></div>
                    </div>
                </div>
            `;

            const optionsDiv = div.querySelector(`#options-${question.id}`);
            question.options.forEach(option => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer';
                const currentAnswers = answers[question.id] || [];
                const isChecked = Array.isArray(currentAnswers) && currentAnswers.includes(option.value);
                label.innerHTML = `
                    <input type="checkbox" value="${option.value}" class="w-4 h-4 text-red-600" ${isChecked ? 'checked' : ''}>
                    <span class="text-sm">${option.label}</span>
                `;
                optionsDiv.appendChild(label);

                label.querySelector('input').addEventListener('change', (e) => {
                    // For questions 25-26, sync both question answers
                    const questionsToSync = question.id === 25 || question.id === 26 ? [25, 26] : [question.id];

                    questionsToSync.forEach(qId => {
                        if (!answers[qId]) {
                            answers[qId] = [];
                        }
                        if (!Array.isArray(answers[qId])) {
                            answers[qId] = [];
                        }

                        if (e.target.checked) {
                            // Limit to exactly 2 selections for multi-choice questions
                            if (answers[qId].length >= 2) {
                                // If already have 2 selections, remove the first one
                                answers[qId].shift();
                            }
                            if (!answers[qId].includes(option.value)) {
                                answers[qId].push(option.value);
                            }
                        } else {
                            answers[qId] = answers[qId].filter(val => val !== option.value);
                        }

                        // Update checkbox states to reflect current selection
                        const allCheckboxes = div.querySelectorAll('input[type="checkbox"]');
                        allCheckboxes.forEach(cb => {
                            cb.checked = answers[qId] && answers[qId].includes(cb.value);
                        });
                    });

                    updateQuestionIndicators();
                });
            });

            return div;
        }

        function createMultipleChoiceQuestion(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.id = `question-${question.id}`;
            div.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                        ${question.id}
                    </div>
                    <div class="flex-1">
                        <p class="mb-3 text-sm">${question.text}</p>
                        <div class="space-y-2" id="options-${question.id}"></div>
                    </div>
                </div>
            `;

            const optionsDiv = div.querySelector(`#options-${question.id}`);
            question.options.forEach(option => {
                const label = document.createElement('label');
                label.className = 'flex items-center space-x-2 cursor-pointer';
                const firstChar = option.label.charAt(0);
                const restOfLabel = option.label.substring(1);
                label.innerHTML = `
                    <input type="radio" name="q${question.id}" value="${option.value}" class="w-4 h-4 text-red-600" ${answers[question.id] === option.value ? 'checked' : ''}>
                    <span class="text-sm"><strong>${firstChar}</strong>${restOfLabel}</span>
                `;
                label.querySelector('input').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        answers[question.id] = e.target.value;
                        updateQuestionIndicators();
                    }
                });
                optionsDiv.appendChild(label);
            });

            return div;
        }

        function createSummaryQuestion(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.id = `question-${question.id}`;
            div.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                        ${question.id}
                    </div>
                    <div class="flex-1 flex items-center space-x-3">
                        <p class="text-sm flex-1">${question.text}</p>
                        <input type="text" value="${answers[question.id] || ''}" class="w-72 h-10 border-2 border-gray-400 text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-3" placeholder="${question.id}">
                    </div>
                </div>
            `;

            div.querySelector('input').addEventListener('input', (e) => {
                answers[question.id] = e.target.value;
                updateQuestionIndicators();
            });

            return div;
        }

        function createPlaceMatchingQuestion(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.id = `question-${question.id}`;
            div.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                        ${question.id}
                    </div>
                    <div class="flex-1 flex items-center space-x-3">
                        <p class="text-sm flex-1">${question.text}</p>
                        <select class="w-16 h-8 border-2 border-gray-400 text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-1">
                            <option value="">${question.id}</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                        </select>
                    </div>
                </div>
            `;

            // Set saved answer if exists
            if (answers[question.id]) {
                div.querySelector('select').value = answers[question.id];
            }

            div.querySelector('select').addEventListener('change', (e) => {
                answers[question.id] = e.target.value;
                updateQuestionIndicators();
            });

            return div;
        }

        function createParagraphMatchingQuestion(question) {
            const div = document.createElement('div');
            div.className = 'question-item';
            div.id = `question-${question.id}`;
            div.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-red-600 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">
                        ${question.id}
                    </div>
                    <div class="flex-1 flex items-center space-x-3">
                        <p class="text-sm flex-1">${question.text}</p>
                        <select value="${answers[question.id] || ''}" class="w-20 h-8 border-2 border-gray-400 text-sm bg-white outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 rounded px-1">
                            <option value="">${question.id}</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="G">G</option>
                            <option value="H">H</option>
                            <option value="I">I</option>
                        </select>
                    </div>
                </div>
            `;

            div.querySelector('select').addEventListener('change', (e) => {
                answers[question.id] = e.target.value;
                updateQuestionIndicators();
            });

            return div;
        }

        function initializeHeadingDragDrop() {
            const headingOptions = document.querySelectorAll('.heading-option');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            // Add drag event listeners to heading options
            headingOptions.forEach(option => {
                option.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', option.dataset.value);
                    e.dataTransfer.setData('text/html', option.innerHTML);
                    option.style.opacity = '0.5';
                });
                
                option.addEventListener('dragend', (e) => {
                    option.style.opacity = '1';
                });
            });
            
            // Add drop event listeners to drop zones
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('border-blue-500', 'bg-blue-50');
                });
                
                zone.addEventListener('dragleave', (e) => {
                    zone.classList.remove('border-blue-500', 'bg-blue-50');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('border-blue-500', 'bg-blue-50');
                    
                    const headingValue = e.dataTransfer.getData('text/plain');
                    const headingHTML = e.dataTransfer.getData('text/html');
                    const questionId = zone.dataset.question;
                    
                    if (headingValue && questionId) {
                        // Clear previous content and add the dropped heading
                        zone.innerHTML = '';
                        zone.classList.remove('border-dashed', 'border-gray-400', 'bg-gray-50', 'text-gray-600');
                        zone.classList.add('border-solid', 'border-green-500', 'bg-green-50');
                        
                        // Create a styled display of the dropped heading
                        const headingDisplay = document.createElement('div');
                        headingDisplay.className = 'flex items-center justify-between w-full';
                        headingDisplay.innerHTML = `
                            <div class="flex items-center">
                                <span class="font-bold mr-2">${questionId}</span>
                                <span class="text-green-700">${headingHTML}</span>
                            </div>
                            <button class="text-red-600 hover:text-red-800 text-sm font-bold ml-2" onclick="clearHeadingAnswer('${questionId}')">‚úï</button>
                        `;
                        zone.appendChild(headingDisplay);
                        
                        // Save the answer
                        answers[questionId] = headingValue;
                        updateQuestionIndicators();
                        
                        // Hide the used heading option
                        const usedOption = document.querySelector(`[data-value="${headingValue}"]`);
                        if (usedOption) {
                            usedOption.style.display = 'none';
                        }
                    }
                });
            });
        }

        function initializeSummaryDragDrop() {
            const draggableOptions = document.querySelectorAll('.draggable-option');
            const dropZones = document.querySelectorAll('.inline-drop-zone');
            
            // Add drag event listeners to draggable options
            draggableOptions.forEach(option => {
                option.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', option.dataset.value);
                    e.dataTransfer.setData('text/html', option.textContent.trim());
                    option.style.opacity = '0.5';
                });
                
                option.addEventListener('dragend', (e) => {
                    option.style.opacity = '1';
                });
            });
            
            // Add drop event listeners to drop zones
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('border-green-500', 'bg-green-50');
                });
                
                zone.addEventListener('dragleave', (e) => {
                    zone.classList.remove('border-green-500', 'bg-green-50');
                });
                
                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('border-green-500', 'bg-green-50');
                    
                    const optionValue = e.dataTransfer.getData('text/plain');
                    const optionText = e.dataTransfer.getData('text/html');
                    const questionId = parseInt(zone.dataset.question);
                    
                    if (optionValue && questionId) {
                        // Clear any previous answer for this question
                        clearSummaryAnswer(questionId);
                        
                        // Update the drop zone appearance
                        zone.classList.remove('border-dashed', 'border-blue-400');
                        zone.classList.add('border-solid', 'border-green-500', 'bg-green-100');
                        zone.textContent = optionText;
                        
                        // Save the answer
                        answers[questionId] = optionValue;
                        updateQuestionIndicators();
                        
                        // Hide the used option
                        const usedOption = document.querySelector(`[data-value="${optionValue}"]`);
                        if (usedOption) {
                            usedOption.style.display = 'none';
                        }
                    }
                });
                
                // Add click event to clear answer
                zone.addEventListener('click', (e) => {
                    if (answers[parseInt(zone.dataset.question)]) {
                        clearSummaryAnswer(parseInt(zone.dataset.question));
                    }
                });
            });
        }

        function clearSummaryAnswer(questionId) {
            const zone = document.querySelector(`[data-question="${questionId}"]`);
            const currentAnswer = answers[questionId];
            
            if (zone && currentAnswer) {
                // Reset the drop zone
                zone.classList.remove('border-solid', 'border-green-500', 'bg-green-100');
                zone.classList.add('border-dashed', 'border-blue-400', 'bg-white');
                zone.textContent = questionId.toString();
                
                // Show the previously used option
                const usedOption = document.querySelector(`[data-value="${currentAnswer}"]`);
                if (usedOption) {
                    usedOption.style.display = 'block';
                }
                
                // Clear the answer
                delete answers[questionId];
                updateQuestionIndicators();
            }
        }

        function clearHeadingAnswer(questionId) {
            const zone = document.querySelector(`[data-question="${questionId}"]`);
            const currentAnswer = answers[questionId];
            
            if (zone && currentAnswer) {
                // Reset the drop zone
                zone.innerHTML = `<span class="font-bold mr-2">${questionId}</span>Drop heading here`;
                zone.classList.remove('border-solid', 'border-green-500', 'bg-green-50');
                zone.classList.add('border-dashed', 'border-gray-400', 'bg-gray-50', 'text-gray-600');
                
                // Show the heading option again
                const headingOption = document.querySelector(`[data-value="${currentAnswer}"]`);
                if (headingOption) {
                    headingOption.style.display = 'block';
                }
                
                // Clear the answer
                delete answers[questionId];
                updateQuestionIndicators();
            }
        }

        function clearSummaryAnswer(questionId) {
            const zone = document.querySelector(`[data-question="${questionId}"]`);
            const currentAnswer = answers[questionId];
            
            if (zone && currentAnswer) {
                // Reset the drop zone - just show the number
                zone.innerHTML = questionId;
                zone.classList.remove('border-solid', 'border-green-500', 'bg-green-50', 'inline-flex', 'items-center');
                zone.classList.add('border-dashed', 'border-gray-400', 'bg-gray-50', 'text-gray-600');
                
                // Show the option again in the options station
                const summaryOption = document.querySelector(`[data-value="${currentAnswer}"]`);
                if (summaryOption) {
                    summaryOption.style.display = 'block';
                }
                
                // Clear the answer
                delete answers[questionId];
                updateQuestionIndicators();
            }
        }

        function createMatchingQuestions(container, questions) {
            // Options box
            const optionsBox = document.createElement('div');
            optionsBox.className = 'border-2 border-gray-400 p-4 bg-gray-50 mb-6';
            optionsBox.innerHTML = `
                <h4 class="font-bold mb-3">Choose from the following options:</h4>
                <div class="grid grid-cols-4 gap-2">
                    <div class="bg-white border-2 border-gray-300 rounded px-2 py-1 text-center cursor-move hover:bg-blue-50 hover:border-blue-400 transition-colors select-none" data-value="A">
                        <div class="font-bold text-sm">A</div>
                        <div class="text-xs">1753</div>
                    </div>
                    <div class="bg-white border-2 border-gray-300 rounded px-2 py-1 text-center cursor-move hover:bg-blue-50 hover:border-blue-400 transition-colors select-none" data-value="B">
                        <div class="font-bold text-sm">B</div>
                        <div class="text-xs">1806</div>
                    </div>
                    <div class="bg-white border-2 border-gray-300 rounded px-2 py-1 text-center cursor-move hover:bg-blue-50 hover:border-blue-400 transition-colors select-none" data-value="C">
                        <div class="font-bold text-sm">C</div>
                        <div class="text-xs">1816</div>
                    </div>
                    <div class="bg-white border-2 border-gray-300 rounded px-2 py-1 text-center cursor-move hover:bg-blue-50 hover:border-blue-400 transition-colors select-none" data-value="D">
                        <div class="font-bold text-sm">D</div>
                        <div class="text-xs">1823</div>
                    </div>
                    <div class="bg-white border-2 border-gray-300 rounded px-2 py-1 text-center cursor-move hover:bg-blue-50 hover:border-blue-400 transition-colors select-none" data-value="E">
                        <div class="font-bold text-sm">E</div>
                        <div class="text-xs">1825</div>
                    </div>
                    <div class="bg-white border-2 border-gray-300 rounded px-2 py-1 text-center cursor-move hover:bg-blue-50 hover:border-blue-400 transition-colors select-none" data-value="F">
                        <div class="font-bold text-sm">F</div>
                        <div class="text-xs">1837</div>
                    </div>
                    <div class="bg-white border-2 border-gray-300 rounded px-2 py-1 text-center cursor-move hover:bg-blue-50 hover:border-blue-400 transition-colors select-none" data-value="G">
                        <div class="font-bold text-sm">G</div>
                        <div class="text-xs">1843</div>
                    </div>
                </div>
            `;
            container.appendChild(optionsBox);

            // Questions
            const questionsDiv = document.createElement('div');
            questionsDiv.className = 'space-y-4';

            questions.forEach(question => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'flex items-center space-x-4';
                questionDiv.id = `question-${question.id}`;
                questionDiv.innerHTML = `
                    <div class="w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold">
                        ${question.id}
                    </div>
                    <div class="flex-1 text-sm">
                        ${question.text}
                    </div>
                    <div class="drop-zone h-8 border-2 border-gray-400 rounded flex items-center justify-center text-sm bg-white transition-colors border-dashed hover:border-blue-400 hover:bg-blue-50 min-w-16" data-question="${question.id}">
                        ${answers[question.id] ? `<span class="font-bold text-sm">${answers[question.id]} <button class="text-red-500 hover:text-red-700 text-xs ml-1">√ó</button></span>` : ''}
                    </div>
                `;
                questionsDiv.appendChild(questionDiv);

                // Add drag and drop functionality
                const dropZone = questionDiv.querySelector('.drop-zone');

                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                });

                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const droppedValue = e.dataTransfer.getData('text/plain');
                    answers[question.id] = droppedValue;
                    updateMatchingDisplay(question.id, droppedValue);
                    updateQuestionIndicators();
                });

                // Add click functionality for clear button
                dropZone.addEventListener('click', (e) => {
                    if (e.target.textContent === '√ó') {
                        answers[question.id] = '';
                        updateMatchingDisplay(question.id, '');
                        updateQuestionIndicators();
                    }
                });
            });

            container.appendChild(questionsDiv);

            // Add drag functionality to options
            optionsBox.querySelectorAll('[data-value]').forEach(option => {
                option.draggable = true;
                option.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', e.target.dataset.value);
                    e.dataTransfer.effectAllowed = 'copy';
                });
            });
        }

        function updateMatchingDisplay(questionId, value) {
            const dropZone = document.querySelector(`[data-question="${questionId}"]`);
            if (value && value.trim() !== '') {
                // Find the matching option to get the label
                const matchingOption = document.querySelector(`[data-value="${value}"]`);
                let displayText = value; // Default fallback
                
                // For summary drag-drop questions, extract just the descriptive text without the letter
                if (matchingOption) {
                    const boldSpan = matchingOption.querySelector('span.font-bold');
                    if (boldSpan) {
                        // Clone and remove the bold span to get clean text
                        const clone = matchingOption.cloneNode(true);
                        const cloneBoldSpan = clone.querySelector('span.font-bold');
                        if (cloneBoldSpan) {
                            cloneBoldSpan.remove();
                            displayText = clone.textContent.trim();
                        }
                    } else {
                        displayText = matchingOption.textContent.trim();
                    }
                }
                
                // Clear previous content and style like heading matching
                dropZone.innerHTML = '';
                dropZone.classList.remove('border-dashed', 'border-gray-400', 'bg-gray-50', 'text-gray-600');
                dropZone.classList.add('border-solid', 'border-green-500', 'bg-green-50', 'inline-flex', 'items-center');
                
                // Create inline content to avoid layout issues - show just the descriptive text
                dropZone.innerHTML = `
                    <span class="font-bold mr-2">${questionId}</span>
                    <span class="text-green-700">${displayText}</span>
                    <button class="text-red-600 hover:text-red-800 text-sm font-bold ml-2" onclick="clearSummaryAnswer('${questionId}')">‚úï</button>
                `;
            } else {
                // Reset to empty state - just show the number
                dropZone.innerHTML = questionId;
                dropZone.classList.remove('border-solid', 'border-green-500', 'bg-green-50', 'inline-flex', 'items-center');
                dropZone.classList.add('border-dashed', 'border-gray-400', 'bg-gray-50', 'text-gray-600');
            }
        }

        // Navigation
        function updateNavigation() {
            // Update navigation buttons
            document.getElementById('prev-part-btn').disabled = currentPart === 1;
            document.getElementById('next-part-btn').disabled = currentPart === testData.parts.length;

            // Update part indicators
            updatePartIndicators();
        }

        function updatePartIndicators() {
            const container = document.getElementById('parts-container');
            container.innerHTML = '';

            testData.parts.forEach((part, index) => {
                const isActive = currentPart === part.id;

                const partDiv = document.createElement('div');
                partDiv.className = 'flex items-center min-w-0 relative';

                const partButton = document.createElement('button');
                partButton.className = `text-base font-medium whitespace-nowrap flex-shrink-0 ${isActive ? 'text-black font-medium' : 'text-gray-400'}`;
                partButton.textContent = `Part ${part.id}`;
                partButton.addEventListener('click', () => {
                    currentPart = part.id;
                    loadPart(currentPart);
                });

                partDiv.appendChild(partButton);

                // Add question indicators if this is the active part
                if (isActive) {
                    const questionsDiv = document.createElement('div');
                    questionsDiv.className = 'flex items-center flex-wrap gap-1 justify-center ml-2';

                    part.questions.forEach((question, qIndex) => {
                        const questionBtn = document.createElement('button');
                        const answer = answers[question.id];
                        const isAnswered = answer && (Array.isArray(answer) ? answer.length > 0 : answer.trim() !== '');

                        questionBtn.className = `w-6 h-6 text-sm font-medium border rounded flex items-center justify-center transition-all duration-200 hover:scale-110 cursor-pointer ${
                            isAnswered
                                ? 'bg-red-600 text-white border-red-600 hover:bg-red-700'
                                : 'bg-white text-gray-600 border-gray-300 hover:border-gray-400 hover:bg-gray-50'
                        }`;
                        questionBtn.textContent = question.id;
                        questionBtn.style.animationDelay = `${qIndex * 20}ms`;
                        questionBtn.style.animation = `fadeInScale 0.3s ease-out ${qIndex * 20}ms both`;

                        questionBtn.addEventListener('click', () => {
                            const element = document.getElementById(`question-${question.id}`);
                            if (element) {
                                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }
                        });

                        questionsDiv.appendChild(questionBtn);
                    });

                    partDiv.appendChild(questionsDiv);
                }

                container.appendChild(partDiv);
            });
        }

        function updateQuestionIndicators() {
            updatePartIndicators();
        }

        function goToPreviousPart() {
            if (currentPart > 1) {
                currentPart--;
                loadPart(currentPart);
            }
        }

        function goToNextPart() {
            if (currentPart < testData.parts.length) {
                currentPart++;
                loadPart(currentPart);
            }
        }

        // Test Submission
        function submitTest() {
            stopTimer();

            // Synchronize Q26 with Q25 (MULTIPLE_CHOICE_TWO questions share the same answer)
            if (answers[25]) {
                answers[26] = answers[25];
            }

            // Calculate results
            let correctAnswers = 0;
            let totalQuestions = 0;
            const results = [];

            testData.parts.forEach(part => {
                part.questions.forEach(question => {
                    // Handle SUMMARY_DRAG_DROP specially - validate each box as a separate question
                    if (question.type === "SUMMARY_DRAG_DROP" && question.boxes && question.boxes.length > 0) {
                        question.boxes.forEach(box => {
                            totalQuestions++;
                            const userAnswer = answers[box.id] || '';
                            const isCorrect = userAnswer.toString().toUpperCase().trim() === box.correctAnswer.toString().toUpperCase().trim();
                            
                            if (isCorrect) {
                                correctAnswers++;
                            }

                            results.push({
                                questionId: box.id,
                                questionText: question.text,
                                questionType: question.type,
                                userAnswer: userAnswer,
                                correctAnswer: box.correctAnswer,
                                isCorrect: isCorrect,
                                explanation: box.explanation || null
                            });
                        });
                        return; // Skip the normal validation for SUMMARY_DRAG_DROP
                    }

                    const userAnswer = answers[question.id] || '';
                    let isCorrect = false;

                    if (question.type === "MULTIPLE_CHOICE_MULTI" && Array.isArray(question.correctAnswer)) {
                        const userAnswerArray = Array.isArray(userAnswer) ? userAnswer : [];
                        const correctSet = new Set(question.correctAnswer);
                        const correctSelections = userAnswerArray.filter(value => correctSet.has(value)).length;

                        totalQuestions += question.correctAnswer.length;
                        correctAnswers += correctSelections;
                        isCorrect = correctSelections === question.correctAnswer.length;
                    } else {
                        totalQuestions++;

                        if (question.type === "VIRTUAL_MULTI") {
                            // Virtual question - check if the specific answer for this question is selected
                            const linkedAnswer = answers[question.linkedTo] || [];
                            if (Array.isArray(linkedAnswer)) {
                                // Q25 gets 1 point if B is selected, Q26 gets 1 point if C is selected
                                isCorrect = linkedAnswer.includes(question.correctAnswer);
                            }
                        } else if (question.type === "MULTIPLE_CHOICE_TWO") {
                        // Q25-26: Each correct answer selected = 1 point
                        // Q25 checks if B is selected, Q26 checks if D is selected
                        if (Array.isArray(userAnswer)) {
                            if (question.id === 25) {
                                isCorrect = userAnswer.includes("B");
                            } else if (question.id === 26) {
                                isCorrect = userAnswer.includes("D");
                            }
                        }
                    } else if (Array.isArray(userAnswer) && !Array.isArray(question.correctAnswer)) {
                        // Multi-select question with single correct answer (Q25: check if B is selected)
                        isCorrect = userAnswer.includes(question.correctAnswer);
                    } else if (Array.isArray(question.correctAnswer) && Array.isArray(userAnswer)) {
                        // Multi-select questions - check if arrays have same elements
                        const sortedCorrect = question.correctAnswer.slice().sort();
                        const sortedUser = userAnswer.slice().sort();
                        isCorrect = sortedCorrect.length === sortedUser.length && 
                                   sortedCorrect.every((val, i) => val === sortedUser[i]);
                    } else if (Array.isArray(question.correctAnswer) && !Array.isArray(userAnswer)) {
                        // Question with multiple acceptable answers (e.g. "colour" or "color")
                        isCorrect = question.correctAnswer.some(correctOption => 
                            userAnswer.toString().toLowerCase().trim() === correctOption.toString().toLowerCase().trim()
                        );
                    } else {
                        // Single answer questions
                        const userAnswerStr = Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer.toString();
                        const correctAnswerStr = Array.isArray(question.correctAnswer) ? question.correctAnswer.join(', ') : question.correctAnswer.toString();
                        isCorrect = userAnswerStr.toLowerCase().trim() === correctAnswerStr.toLowerCase().trim();
                    }

                        if (isCorrect) {
                            correctAnswers++;
                        }
                    }

                    
                    results.push({
                        questionId: question.id,
                        questionText: question.text,
                        questionType: question.type,
                        userAnswer: question.type === "VIRTUAL_MULTI" ? 
                                   (Array.isArray(answers[question.linkedTo]) ? answers[question.linkedTo].join(', ') : '') :
                                   (Array.isArray(userAnswer) ? userAnswer.join(', ') : userAnswer),
                        correctAnswer: Array.isArray(question.correctAnswer) ? question.correctAnswer.join(', ') : question.correctAnswer,
                        isCorrect: isCorrect,
                        explanation: question.explanation || null
                    });
                });
            });

            const score = Math.round((correctAnswers / totalQuestions) * 100);
            const timeSpent = (testData.duration * 60) - timeRemaining;
            
            // Sort results by question ID for proper order
            results.sort((a, b) => a.questionId - b.questionId);

            showResults(score, correctAnswers, totalQuestions, timeSpent, results);
        }

        function showSubmitConfirmation() {
            const modal = document.getElementById('submit-confirmation-modal');
            modal.classList.remove('hidden');
            // Prevent background scrolling
            document.body.style.overflow = 'hidden';
        }

        function hideSubmitConfirmation() {
            const modal = document.getElementById('submit-confirmation-modal');
            modal.classList.add('hidden');
            // Restore background scrolling
            document.body.style.overflow = 'auto';
        }

        function formatUserAnswer(answer, questionType) {
            if (!answer) return '(No answer)';
            
            // Convert True/False answers to display format
            if (questionType === "TRUE_FALSE_NOT_GIVEN") {
                if (answer === "true") return "TRUE";
                if (answer === "false") return "FALSE";
                if (answer === "not-given") return "NOT GIVEN";
            }
            
            return answer;
        }

        function calculateBandScore(correctAnswers) {
            // IELTS Band Score Conversion (out of 40 questions)
            if (correctAnswers >= 37) return 9.0;
            if (correctAnswers >= 34) return 8.0;
            if (correctAnswers >= 27) return 7.0;
            if (correctAnswers >= 19) return 6.0;
            if (correctAnswers >= 15) return 5.0;
            if (correctAnswers >= 12) return 4.0;
            if (correctAnswers >= 8) return 3.0;
            if (correctAnswers >= 4) return 2.0;
            if (correctAnswers >= 1) return 1.0;
            return 1.0;
        }

        function getBandFeedback(bandScore) {
            const feedbacks = {
                9.0: {
                    band: 'Band 9 ‚Äî Expert User',
                    typical: '37‚Äì40 / 40',
                    description: 'Fully understands all text types. Predicts answers accurately. Maintains control under pressure. Near-perfect performance.',
                    canDo: [
                        'Read ideas, not sentences',
                        'Predict answers before reading options',
                        'Control pace completely',
                        'Never panic'
                    ],
                    problems: [
                        'Careless mistakes',
                        'Mental fatigue near the end',
                        'Rare but costly misinterpretations'
                    ],
                    mainFocus: 'Maintain exposure to academic reading and exam sharpness',
                    nextSteps: [
                        'Double-check: numbers, comparisons, absolute words (all / only / never)',
                        'Build exam stamina',
                        'Practice under real conditions only'
                    ]
                },
                8.5: {
                    band: 'Band 8‚Äì8.5 ‚Äî Very Good User',
                    typical: '34‚Äì36 / 40',
                    description: 'Reads fluently and strategically. Controls pace and question order. Makes very few mistakes. Errors are usually careless.',
                    canDo: [
                        'Read academically and strategically',
                        'Instantly identify paragraph function',
                        'Handle all question types'
                    ],
                    problems: [
                        'Careless mistakes',
                        'Mental fatigue near the end',
                        'Rare but costly misinterpretations'
                    ],
                    mainFocus: 'Stamina, consistency, final-check discipline',
                    nextSteps: [
                        'Highlight modifiers, cause vs effect',
                        'Trust first instinct more',
                        'Aim for error reduction, not new strategies'
                    ]
                },
                8.0: {
                    band: 'Band 8 ‚Äî Very Good User',
                    typical: '34‚Äì36 / 40',
                    description: 'Reads fluently and strategically. Controls pace and question order. Makes very few mistakes. Errors are usually careless.',
                    canDo: [
                        'Read academically and strategically',
                        'Instantly identify paragraph function',
                        'Handle all question types'
                    ],
                    problems: [
                        'Careless mistakes',
                        'Mental fatigue near the end',
                        'Rare but costly misinterpretations'
                    ],
                    mainFocus: 'Stamina, consistency, final-check discipline',
                    nextSteps: [
                        'Highlight modifiers, cause vs effect',
                        'Trust first instinct more',
                        'Aim for error reduction, not new strategies'
                    ]
                },
                7.5: {
                    band: 'Band 7‚Äì7.5 ‚Äî Good User',
                    typical: '27‚Äì33 / 40',
                    description: 'Understands complex arguments. Strong paraphrase awareness. Misses marks due to precision errors. Occasionally overthinks.',
                    canDo: [
                        'Understand complex ideas',
                        'Handle paraphrasing well',
                        'Complete most question types confidently'
                    ],
                    problems: [
                        'Lose marks in tricky wording',
                        'Miss qualifiers (some, often, mainly)',
                        'Overthink "easy" questions',
                        'Inconsistent accuracy'
                    ],
                    mainFocus: 'Modifiers, qualifiers, inference accuracy',
                    nextSteps: [
                        'Highlight modifiers, cause vs effect',
                        'Trust first instinct more',
                        'Aim for error reduction, not new strategies'
                    ]
                },
                7.0: {
                    band: 'Band 7 ‚Äî Good User',
                    typical: '27‚Äì33 / 40',
                    description: 'Understands complex arguments. Strong paraphrase awareness. Misses marks due to precision errors. Occasionally overthinks.',
                    canDo: [
                        'Understand complex ideas',
                        'Handle paraphrasing well',
                        'Complete most question types confidently'
                    ],
                    problems: [
                        'Lose marks in tricky wording',
                        'Miss qualifiers (some, often, mainly)',
                        'Overthink "easy" questions',
                        'Inconsistent accuracy'
                    ],
                    mainFocus: 'Modifiers, qualifiers, inference accuracy',
                    nextSteps: [
                        'Highlight modifiers, cause vs effect',
                        'Trust first instinct more',
                        'Aim for error reduction, not new strategies'
                    ]
                },
                6.5: {
                    band: 'Band 6‚Äì6.5 ‚Äî Competent User',
                    typical: '19‚Äì26 / 40',
                    description: 'Locates information reasonably efficiently. Handles short paraphrases. Inconsistent accuracy in complex tasks. Weak at Matching Headings & TFNG.',
                    canDo: [
                        'Locate information reasonably fast',
                        'Handle short paraphrases',
                        'Manage most question types in Passage 1‚Äì2'
                    ],
                    problems: [
                        'Matching Headings = disaster',
                        'Confuse FALSE vs NOT GIVEN',
                        'Vocabulary limits comprehension in Passage 3',
                        'Re-read too much'
                    ],
                    mainFocus: 'Paragraph purpose, logical reading, error reduction',
                    nextSteps: [
                        'Train main idea in 10 seconds per paragraph',
                        'TFNG rule: FALSE = contradicts, NOT GIVEN = no info',
                        'Passage-based timing: P1: 15 min, P2: 20 min, P3: 25 min'
                    ]
                },
                6.0: {
                    band: 'Band 6 ‚Äî Competent User',
                    typical: '19‚Äì26 / 40',
                    description: 'Locates information reasonably efficiently. Handles short paraphrases. Inconsistent accuracy in complex tasks. Weak at Matching Headings & TFNG.',
                    canDo: [
                        'Locate information reasonably fast',
                        'Handle short paraphrases',
                        'Manage most question types in Passage 1‚Äì2'
                    ],
                    problems: [
                        'Matching Headings = disaster',
                        'Confuse FALSE vs NOT GIVEN',
                        'Vocabulary limits comprehension in Passage 3',
                        'Re-read too much'
                    ],
                    mainFocus: 'Paragraph purpose, logical reading, error reduction',
                    nextSteps: [
                        'Train main idea in 10 seconds per paragraph',
                        'TFNG rule: FALSE = contradicts, NOT GIVEN = no info',
                        'Passage-based timing: P1: 15 min, P2: 20 min, P3: 25 min'
                    ]
                },
                5.5: {
                    band: 'Band 5‚Äì5.5 ‚Äî Modest User',
                    typical: '15‚Äì18 / 40',
                    description: 'Understands general meaning in simple texts. Relies too much on matching words. TFNG questions are mostly incorrect. Passage 3 is overwhelming.',
                    canDo: [
                        'Understand simple factual information',
                        'Find exact words in the text',
                        'Cope with short, straightforward paragraphs'
                    ],
                    problems: [
                        'Read word-by-word instead of scanning',
                        'Panic when wording changes (paraphrasing)',
                        'TFNG = guessing game',
                        'Spend too long on Passage 1 ‚Üí die in Passage 3'
                    ],
                    mainFocus: 'Idea-based reading, skipping strategies, time discipline',
                    nextSteps: [
                        'Train keyword scanning, not full reading',
                        'Teach: True = same meaning, not same words',
                        'Force time limits (20 min per passage max)'
                    ]
                },
                5.0: {
                    band: 'Band 5 ‚Äî Modest User',
                    typical: '15‚Äì18 / 40',
                    description: 'Understands general meaning in simple texts. Relies too much on matching words. TFNG questions are mostly incorrect. Passage 3 is overwhelming.',
                    canDo: [
                        'Understand simple factual information',
                        'Find exact words in the text',
                        'Cope with short, straightforward paragraphs'
                    ],
                    problems: [
                        'Read word-by-word instead of scanning',
                        'Panic when wording changes (paraphrasing)',
                        'TFNG = guessing game',
                        'Spend too long on Passage 1 ‚Üí die in Passage 3'
                    ],
                    mainFocus: 'Idea-based reading, skipping strategies, time discipline',
                    nextSteps: [
                        'Train keyword scanning, not full reading',
                        'Teach: True = same meaning, not same words',
                        'Force time limits (20 min per passage max)'
                    ]
                },
                4.5: {
                    band: 'Band 4‚Äì4.5 ‚Äî Limited User',
                    typical: '10‚Äì14 / 40',
                    description: 'Understands straightforward information. Can answer some Passage 1 questions. Severe time-management problems. Paraphrasing causes confusion.',
                    canDo: [
                        'Understand straightforward information',
                        'Answer some Passage 1 questions',
                        'Find exact matches'
                    ],
                    problems: [
                        'Severe time-management problems',
                        'Paraphrasing causes confusion',
                        'Cannot handle complex passages',
                        'Weak vocabulary'
                    ],
                    mainFocus: 'Keyword scanning, paraphrase recognition, strict timing',
                    nextSteps: [
                        'Learn basic scanning techniques',
                        'Build vocabulary systematically',
                        'Practice with strict time limits'
                    ]
                },
                4.0: {
                    band: 'Band 4 ‚Äî Limited User',
                    typical: '12‚Äì14 / 40',
                    description: 'Understand straightforward information. Manage part of Passage 1. Search for exact words only. Struggle with paraphrasing. TFNG questions mostly incorrect.',
                    canDo: [
                        'Understand straightforward information',
                        'Manage part of Passage 1',
                        'Find exact word matches'
                    ],
                    problems: [
                        'Search for exact words only',
                        'Struggle with paraphrasing',
                        'TFNG questions mostly incorrect',
                        'No clear reading strategy'
                    ],
                    mainFocus: 'Train keyword scanning, not full reading',
                    nextSteps: [
                        'Learn the difference between FALSE and NOT GIVEN',
                        'Set strict time limits per passage',
                        'Practice with simple paraphrases'
                    ]
                },
                3.5: {
                    band: 'Band 3‚Äì3.5 ‚Äî Extremely Limited User',
                    typical: '6‚Äì9 / 40',
                    description: 'Understands very simple sentences. Can answer a few factual questions with support. Loses meaning beyond one sentence.',
                    canDo: [
                        'Understand very simple sentences',
                        'Answer a few factual questions with support',
                        'Recognize basic vocabulary'
                    ],
                    problems: [
                        'Loses meaning beyond one sentence',
                        'Cannot identify main ideas',
                        'Heavy reliance on guessing',
                        'No reading strategy'
                    ],
                    mainFocus: 'Improve sentence-level comprehension and scanning basics',
                    nextSteps: [
                        'Focus on one sentence at a time',
                        'Build basic vocabulary',
                        'Learn to identify key information'
                    ]
                },
                3.0: {
                    band: 'Band 3 ‚Äî Extremely Limited User',
                    typical: '6‚Äì9 / 40',
                    description: 'Understands very simple sentences. Can answer a few factual questions with support. Loses meaning beyond one sentence.',
                    canDo: [
                        'Understand very simple sentences',
                        'Answer a few factual questions with support',
                        'Recognize basic vocabulary'
                    ],
                    problems: [
                        'Loses meaning beyond one sentence',
                        'Cannot identify main ideas',
                        'Heavy reliance on guessing',
                        'No reading strategy'
                    ],
                    mainFocus: 'Improve sentence-level comprehension and scanning basics',
                    nextSteps: [
                        'Focus on one sentence at a time',
                        'Build basic vocabulary',
                        'Learn to identify key information'
                    ]
                },
                2.5: {
                    band: 'Band 2‚Äì2.5 ‚Äî Intermittent User',
                    typical: '4‚Äì6 / 40',
                    description: 'Understands isolated words only. Struggles with even very short texts. Cannot locate information. Heavy reliance on guessing.',
                    canDo: [
                        'Understand isolated words',
                        'Recognize some high-frequency vocabulary',
                        'Answer with random guessing'
                    ],
                    problems: [
                        'Struggles with very short texts',
                        'Cannot locate information',
                        'Heavy reliance on guessing',
                        'No comprehension strategy'
                    ],
                    mainFocus: 'Develop basic reading habits and high-frequency vocabulary',
                    nextSteps: [
                        'Learn high-frequency vocabulary',
                        'Practice simple sentence reading',
                        'Build basic reading confidence'
                    ]
                },
                2.0: {
                    band: 'Band 2 ‚Äî Intermittent User',
                    typical: '4‚Äì6 / 40',
                    description: 'Understands isolated words only. Struggles with even very short texts. Cannot locate information. Heavy reliance on guessing.',
                    canDo: [
                        'Understand isolated words',
                        'Recognize some high-frequency vocabulary',
                        'Answer with random guessing'
                    ],
                    problems: [
                        'Struggles with very short texts',
                        'Cannot locate information',
                        'Heavy reliance on guessing',
                        'No comprehension strategy'
                    ],
                    mainFocus: 'Develop basic reading habits and high-frequency vocabulary',
                    nextSteps: [
                        'Learn high-frequency vocabulary',
                        'Practice simple sentence reading',
                        'Build basic reading confidence'
                    ]
                },
                1.0: {
                    band: 'Band 1 ‚Äî Non-User',
                    typical: '0‚Äì3 / 40',
                    description: 'Understand only a few isolated words. Cannot follow sentences or instructions. No basic vocabulary. Cannot recognize sentence structure. Answers are random or missing.',
                    canDo: [
                        'Understand a few isolated words',
                        'Recognize letters and numbers',
                        'Identify very familiar names'
                    ],
                    problems: [
                        'No basic vocabulary',
                        'Cannot recognize sentence structure',
                        'Answers are random or missing',
                        'No understanding of sentence meaning'
                    ],
                    mainFocus: 'Build foundational English literacy skills',
                    nextSteps: [
                        'Learn the alphabet and basic sentence patterns',
                        'Build core vocabulary (everyday words)',
                        'Read very short, simple texts daily'
                    ]
                }
            };
            return feedbacks[bandScore] || feedbacks[1.0];
        }

        function showResults(score, correctAnswers, totalQuestions, timeSpent, results) {
            const bandScore = calculateBandScore(correctAnswers);
            const feedback = getBandFeedback(bandScore);

            const modal = document.getElementById('results-modal');
            const content = document.getElementById('results-content');

            content.innerHTML = `
                <div class="text-center mb-6 pb-6 border-b-2">
                    <div class="text-3xl font-bold text-gray-800 mb-2">${feedback.band}</div>
                    <div class="text-sm text-gray-600 italic mb-4">${feedback.description}</div>
                    <div class="text-lg text-gray-600 mb-4">${correctAnswers} out of ${totalQuestions} correct</div>
                    <div class="text-sm text-gray-500 mb-4">Typical score: ~${feedback.typical}</div>
                    <div class="text-sm text-gray-500">Time spent: ${Math.floor(timeSpent / 60)}:${(timeSpent % 60).toString().padStart(2, '0')}</div>
                </div>

                <div class="space-y-6 mb-6">
                    <div>
                        <h4 class="font-bold text-green-700 mb-3">‚úì What you can do at this level</h4>
                        <ul class="text-sm text-gray-700 space-y-2">
                            ${feedback.canDo.map(item => `<li class="flex items-start"><span class="mr-2">‚Ä¢</span><span>${item}</span></li>`).join('')}
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-bold text-red-600 mb-3">‚úó Main problems</h4>
                        <ul class="text-sm text-gray-700 space-y-2">
                            ${feedback.problems.map(item => `<li class="flex items-start"><span class="mr-2">‚ùå</span><span>${item}</span></li>`).join('')}
                        </ul>
                    </div>

                    <div class="bg-blue-50 p-3 rounded border-l-4 border-blue-500">
                        <h4 class="font-bold text-blue-700 mb-2">üìç Your focus area</h4>
                        <p class="text-sm text-gray-700 mb-3 font-semibold">${feedback.mainFocus}</p>
                        <h4 class="font-bold text-blue-700 mb-2">‚Üí Next steps to improve</h4>
                        <ul class="text-sm text-gray-700 space-y-2">
                            ${feedback.nextSteps.map(step => `<li class="flex items-start"><span class="mr-2">‚Üí</span><span>${step}</span></li>`).join('')}
                        </ul>
                    </div>
                </div>

                <details class="mb-6 border rounded p-3 bg-gray-50">
                    <summary class="font-bold cursor-pointer text-gray-700">Answer Details</summary>
                    <div class="space-y-2 mt-4">
                        ${results.map(result => `
                            <div class="py-3 px-3 rounded ${result.isCorrect ? 'bg-green-50' : 'bg-red-50'} mb-3">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="font-medium">Q${result.questionId}</span>
                                    <div class="text-sm">
                                        <span class="text-gray-600">Your answer: </span>
                                        <span class="${result.isCorrect ? 'text-green-600 font-medium' : 'text-red-600 font-medium'}">${formatUserAnswer(result.userAnswer, result.questionType)}</span>
                                        ${!result.isCorrect ? `<span class="text-gray-600"> | Correct: </span><span class="text-green-600 font-medium">${result.correctAnswer}</span>` : ''}
                                    </div>
                                </div>
                                ${result.explanation ? `<div class="text-sm text-gray-700 bg-white/50 rounded px-2 py-1 mt-2"><strong>Explanation:</strong> ${result.explanation}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </details>
            `;

            modal.classList.remove('hidden');
            // Prevent background scrolling
            document.body.style.overflow = 'hidden';
        }

        // Cursor Lightning Effect for Logo (copied from Listening Mock 1)
        (function() {
            const logoContainer = document.querySelector('.logo-container');
            const electricLogo = document.querySelector('.electric-logo');
            const plasmaRing = document.querySelector('.plasma-ring');
            const lightningContainer = document.getElementById('cursor-lightning-container');

            if (!logoContainer || !electricLogo || !lightningContainer) return;

            const PROXIMITY_THRESHOLD = 150; // pixels from logo center to trigger
            let isZapping = false;

            // Create a single SVG that covers the whole screen
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'fixed';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100vw';
            svg.style.height = '100vh';
            svg.style.pointerEvents = 'none';
            svg.style.zIndex = '3500';
            lightningContainer.appendChild(svg);

            // Create bolt paths
            const boltPaths = [];
            const glowPaths = [];
            for (let i = 0; i < 3; i++) {
                const glow = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                glow.setAttribute('fill', 'none');
                glow.setAttribute('stroke', '#ffffff');
                glow.setAttribute('stroke-width', '4');
                glow.setAttribute('stroke-linecap', 'round');
                glow.style.filter = 'blur(3px)';
                glow.style.opacity = '0';
                svg.appendChild(glow);
                glowPaths.push(glow);

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', '#00ddff');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('stroke-linecap', 'round');
                path.style.filter = 'drop-shadow(0 0 3px #00ffff) drop-shadow(0 0 6px #00aaff)';
                path.style.opacity = '0';
                svg.appendChild(path);
                boltPaths.push(path);
            }

            // Generate jagged lightning path from cursor to logo
            function generateLightningPath(x1, y1, x2, y2) {
                const segments = 5 + Math.floor(Math.random() * 3);
                const dx = (x2 - x1) / segments;
                const dy = (y2 - y1) / segments;
                const distance = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                const jitter = Math.min(distance * 0.2, 25);

                let path = `M${x1},${y1}`;

                for (let i = 1; i < segments; i++) {
                    const px = x1 + dx * i + (Math.random() - 0.5) * jitter;
                    const py = y1 + dy * i + (Math.random() - 0.5) * jitter;
                    path += ` L${px},${py}`;
                }
                path += ` L${x2},${y2}`;

                return path;
            }

            function updateLightning(mouseX, mouseY) {
                const logoRect = logoContainer.getBoundingClientRect();
                const logoCenterX = logoRect.left + logoRect.width / 2;
                const logoCenterY = logoRect.top + logoRect.height / 2;

                const distance = Math.sqrt((mouseX - logoCenterX) ** 2 + (mouseY - logoCenterY) ** 2);

                if (distance < PROXIMITY_THRESHOLD && distance > 40) {
                    if (!isZapping) {
                        isZapping = true;
                        electricLogo.classList.add('zapping');
                        if (plasmaRing) plasmaRing.classList.add('zapping');
                    }

                    boltPaths.forEach((path, index) => {
                        const angle = (index * 120 + Math.random() * 60 - 30) * Math.PI / 180;
                        const targetX = logoCenterX + Math.cos(angle) * 40;
                        const targetY = logoCenterY + Math.sin(angle) * 40;

                        const pathD = generateLightningPath(mouseX, mouseY, targetX, targetY);
                        path.setAttribute('d', pathD);
                        path.style.opacity = '1';
                        glowPaths[index].setAttribute('d', pathD);
                        glowPaths[index].style.opacity = '0.7';
                    });
                } else {
                    if (isZapping) {
                        isZapping = false;
                        electricLogo.classList.remove('zapping');
                        if (plasmaRing) plasmaRing.classList.remove('zapping');
                        boltPaths.forEach((path, index) => {
                            path.style.opacity = '0';
                            glowPaths[index].style.opacity = '0';
                        });
                    }
                }
            }

            let lastMouseX = 0, lastMouseY = 0;
            setInterval(() => {
                if (isZapping) {
                    updateLightning(lastMouseX, lastMouseY);
                }
            }, 40);

            document.addEventListener('mousemove', (e) => {
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                updateLightning(e.clientX, e.clientY);
            });
        })();

        // Premium Modal logic with video intro and fullscreen/shrink effect (copied from Listening Mock 1)
        (function() {
            const premiumBtn = document.getElementById('premium-btn');
            const premiumModalBg = document.getElementById('premium-modal-bg');
            const closePremiumModal = document.getElementById('close-premium-modal');
            const premiumVideo = document.getElementById('premium-intro-video');
            const premiumVideoContainer = document.getElementById('premium-video-container');
            const premiumInfoContent = document.getElementById('premium-info-content');
            let shrinkTimeout;

            if (premiumBtn && premiumModalBg && closePremiumModal && premiumVideo && premiumVideoContainer) {
                premiumBtn.addEventListener('click', function() {
                    premiumModalBg.style.display = 'flex';
                    premiumVideoContainer.style.display = 'flex';
                    premiumVideo.style.maxWidth = '100%';
                    premiumVideo.style.height = '60vh';
                    premiumVideo.style.width = '100%';
                    premiumVideoContainer.style.background = 'black';
                    premiumVideo.currentTime = 0;
                    premiumVideo.play();
                    closePremiumModal.style.display = 'none';
                    if (premiumInfoContent) {
                        premiumInfoContent.style.opacity = '0';
                        premiumInfoContent.style.pointerEvents = 'none';
                    }
                    if (premiumVideo.requestFullscreen) {
                        premiumVideo.requestFullscreen();
                    } else if (premiumVideo.webkitRequestFullscreen) {
                        premiumVideo.webkitRequestFullscreen();
                    } else if (premiumVideo.msRequestFullscreen) {
                        premiumVideo.msRequestFullscreen();
                    }
                    clearTimeout(shrinkTimeout);
                    shrinkTimeout = setTimeout(function() {
                        if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                            if (document.exitFullscreen) {
                                document.exitFullscreen();
                            } else if (document.webkitExitFullscreen) {
                                document.webkitExitFullscreen();
                            } else if (document.msExitFullscreen) {
                                document.msExitFullscreen();
                            }
                        }
                        premiumVideo.style.maxWidth = '320px';
                        premiumVideo.style.height = '';
                        premiumVideo.style.width = '';
                        premiumVideoContainer.style.background = '';
                        premiumVideoContainer.style.justifyContent = 'center';
                        premiumVideoContainer.style.alignItems = 'center';
                        premiumInfoContent.style.opacity = '1';
                        premiumInfoContent.style.pointerEvents = 'auto';
                        closePremiumModal.style.display = 'block';
                    }, 7000);
                });

                closePremiumModal.addEventListener('click', function() {
                    premiumModalBg.style.display = 'none';
                    premiumVideo.pause();
                    premiumVideoContainer.style.display = 'none';
                    clearTimeout(shrinkTimeout);
                });

                premiumModalBg.addEventListener('click', function(e) {
                    if (e.target === premiumModalBg) {
                        premiumModalBg.style.display = 'none';
                        premiumVideo.pause();
                        premiumVideoContainer.style.display = 'none';
                        clearTimeout(shrinkTimeout);
                    }
                });
            }
        })();

        // Welcome Modal - Always show and play sound
        (function() {
            const welcomeModalBg = document.getElementById('welcome-modal-bg');
            const welcomeStartBtn = document.getElementById('welcome-start-btn');

            if (welcomeModalBg && welcomeStartBtn) {
                welcomeModalBg.style.display = 'flex';

                welcomeStartBtn.addEventListener('click', function() {
                    playStartSound();
                    welcomeModalBg.classList.add('glitch-fade-out');

                    setTimeout(function() {
                        welcomeModalBg.style.display = 'none';
                    }, 800);
                });
            }

            function playStartSound() {
                try {
                    const audio = new Audio('https://pub-a3ed3eec4ae344b4917067de0a9376f1.r2.dev/SOUND%20EEFECT%20mixkit-sci-fi-positive-notification-266.wav');
                    audio.volume = 0.7;
                    audio.play();
                } catch (e) {
                    console.log('Audio error:', e);
                }
            }
        })();

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize
            loadPart(currentPart);
            updateTimerDisplay();

            // Timer controls
            document.getElementById('timer-toggle').addEventListener('click', toggleTimer);

            // Panel resizing
            document.getElementById('resize-handle').addEventListener('mousedown', handleMouseDown);
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);

            // Navigation
            document.getElementById('prev-part-btn').addEventListener('click', goToPreviousPart);
            document.getElementById('next-part-btn').addEventListener('click', goToNextPart);
            document.getElementById('submit-test-btn').addEventListener('click', function() {
                // Show custom confirmation modal
                showSubmitConfirmation();
            });

            // Highlighting
            document.getElementById('highlight-button').addEventListener('click', addHighlight);
            document.getElementById('clear-highlight-button').addEventListener('click', () => {
                if (clearHighlightButton.highlightId) {
                    removeHighlight(clearHighlightButton.highlightId);
                    hideClearHighlightButton();
                }
            });

            // Text selection for highlighting
            document.addEventListener('mouseup', (e) => {
                // Don't hide buttons if clicking on them
                if (e.target.closest('#highlight-button') || e.target.closest('#clear-highlight-button')) {
                    return;
                }

                const selection = window.getSelection();
                if (selection && !selection.isCollapsed) {
                    const selectedText = selection.toString().trim();
                    if (selectedText.length > 0) {
                        const range = selection.getRangeAt(0);
                        const x = e.clientX + 10;
                        const y = e.clientY - 35;
                        const clonedRange = range.cloneRange();
                        showHighlightButton(x, y, clonedRange);
                    }
                } else {
                    hideHighlightButton();
                }

                if (e.button !== 2) {
                    hideClearHighlightButton();
                }
            });

            document.addEventListener('mousedown', (e) => {
                if (!e.target.closest('#highlight-button') && !e.target.closest('#clear-highlight-button')) {
                    hideHighlightButton();
                    hideClearHighlightButton();
                }
            });

            // Submit confirmation modal
            document.getElementById('cancel-submit').addEventListener('click', () => {
                hideSubmitConfirmation();
            });
            document.getElementById('confirm-submit').addEventListener('click', () => {
                hideSubmitConfirmation();
                submitTest();
            });

            // Results modal
            document.getElementById('close-results').addEventListener('click', () => {
                document.getElementById('results-modal').classList.add('hidden');
                // Restore background scrolling
                document.body.style.overflow = 'auto';
            });

        });
    </script>
</body>
</html>
